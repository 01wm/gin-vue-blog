import{x as z,k as f,o as T,c as U,w as i,m as v,a as n,b as y,u as r,l as B,d as N,z as o,E as I,F as b,N as d,A as S,B as c}from"./index-7e9df7d9.js";import{_ as q}from"./CommonPage-7491aea4.js";import{_ as k}from"./QueryItem-0f282244.js";import{_ as P}from"./CrudTable-121684b7.js";import{c as x,d as D}from"./config-7d76553c.js";import{u as R}from"./useCRUD-f64dec52.js";import{N as V}from"./Image-77507ba9.js";import{N as K,a as h}from"./Tabs-44f6c44d.js";import{N as M}from"./Input-5db271d7.js";import{N as O}from"./Space-f54cd109.js";import{N as j}from"./Popconfirm-6b45faf2.js";import"./AppPage-848b5b84.js";import"./Checkbox-ac1591ea.js";import"./RadioGroup-757891b8.js";import"./get-slot-1efb97e5.js";import"./Forward-8d8448e7.js";import"./utils-3c01791b.js";import"./Add-3a899e67.js";const A=N("span",{class:"i-material-symbols:recycling-rounded"},null,-1),E=N("span",{class:"i-ic:outline-approval"},null,-1),me=Object.assign({name:"评论管理"},{__name:"index",setup(F){z(()=>{w("all")});const s=f(null),m=f({nickname:"",type:""}),u=f({is_review:null}),{handleDelete:g}=R({name:"评论",doDelete:v.deleteComments,refresh:()=>{var e;return(e=s.value)==null?void 0:e.handleSearch()}}),C=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render(e){return o(V,{height:50,imgProps:{style:{"border-radius":"3px"}},src:I(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"评论人",key:"nickname",width:50,align:"center",ellipsis:{tooltip:!0}},{title:"回复对象",key:"reply_nick_name",width:50,align:"center",render(e){return o("span",e.reply_nickname||"无")}},{title:"评论内容",key:"content",width:140,align:"center",ellipsis:{tooltip:!0}},{title:"评论时间",key:"created_at",align:"center",width:60,render(e){return o(d,{size:"small",type:"text",ghost:!0},{default:()=>S(e.created_at),icon:c("mdi:update",{size:18})})}},{title:"状态",key:"is_review",width:50,align:"center",render(e){return o(b,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})}},{title:"来源",key:"type",width:50,align:"center",render(e){return o(b,{type:x[e.type].tag},{default:()=>x[e.type].name})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(e){return[e.is_review?o(d,{size:"small",type:"warning",style:"margin-left: 15px;",onClick:()=>p([e.id],0)},{default:()=>"撤下",icon:c("mi:circle-error",{size:16})}):o(d,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>p([e.id],1)},{default:()=>"通过",icon:c("mi:circle-check",{size:16})}),o(j,{onPositiveClick:()=>g([e.id],!1)},{trigger:()=>o(d,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:c("material-symbols:delete-outline",{size:16})}),default:()=>o("div",{},"确定删除该条评论吗?")})]}}];async function p(e,t){var a,l;if(!e.length){window.$message.info("请选择要审核的数据");return}await v.updateCommentReview({ids:e,is_review:t}),(a=window.$message)==null||a.success(t?"审核成功":"撤下成功"),(l=s.value)==null||l.handleSearch()}function w(e){var t;switch(e){case"all":u.value.is_review=null;break;case"has_review":u.value.is_review=1;break;case"not_review":u.value.is_review=0;break}(t=s.value)==null||t.handleSearch()}return(e,t)=>(T(),U(q,{title:"评论管理"},{action:i(()=>{var a,l;return[n(r(d),{type:"error",disabled:!((a=s.value)!=null&&a.selections.length),onClick:t[0]||(t[0]=$=>{var _;return r(g)((_=s.value)==null?void 0:_.selections)})},{icon:i(()=>[A]),default:i(()=>[y(" 批量删除 ")]),_:1},8,["disabled"]),n(r(d),{type:"success",disabled:!((l=s.value)!=null&&l.selections.length),onClick:t[1]||(t[1]=$=>p(s.value.selections,1))},{icon:i(()=>[E]),default:i(()=>[y(" 批量通过 ")]),_:1},8,["disabled"])]}),default:i(()=>[n(r(K),{type:"line",animated:"","onUpdate:value":w},{prefix:i(()=>[y(" 状态 ")]),default:i(()=>[n(r(h),{name:"all",tab:"全部"}),n(r(h),{name:"has_review",tab:"通过"}),n(r(h),{name:"not_review",tab:"审核中"})]),_:1}),n(P,{ref_key:"$table",ref:s,"query-items":m.value,"onUpdate:queryItems":t[6]||(t[6]=a=>m.value=a),"extra-params":u.value,columns:C,"get-data":r(v).getComments},{queryBar:i(()=>[n(k,{label:"用户","label-width":40,"content-width":180},{default:i(()=>[n(r(M),{value:m.value.nickname,"onUpdate:value":t[2]||(t[2]=a=>m.value.nickname=a),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:t[3]||(t[3]=B(a=>{var l;return(l=s.value)==null?void 0:l.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),n(k,{label:"来源","label-width":40,"content-width":160},{default:i(()=>[n(r(O),{value:m.value.type,"onUpdate:value":[t[4]||(t[4]=a=>m.value.type=a),t[5]||(t[5]=a=>{var l;return(l=s.value)==null?void 0:l.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择评论来源",options:r(D)},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{me as default};
