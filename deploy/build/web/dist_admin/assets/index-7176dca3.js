import{A as ae,B as te,C as le,D as ne,E as se,F as M,G as oe,H as ie,I as ue,e as p,J,K as re,L as de,M as z,O as ce,s as I,P as pe,Q,z as X,N as j,R as me,S as $,T as ve,c as fe,U as ge,V as E,p as he,x as ye,l as A,o as D,f as q,w as i,g as be,j as n,i as s,W as G,X as L,h as k}from"./index-7d3bcf57.js";import{W as _e}from"./style-cf5e443b.js";import{_ as Te}from"./CommonPage-60900c13.js";import{_ as Ce}from"./CrudModal-d5d9f5ee.js";import{_ as we}from"./UploadOne-7994ca3e.js";import{b as Re}from"./config-7d76553c.js";import{N as Ve,a as V}from"./FormItem-f3617c31.js";import{u as Ie,N as W}from"./Input-41b621cb.js";import{s as xe,a as Oe,b as Y,N as P}from"./Space-dcdf9175.js";import{A as Se}from"./Add-58674542.js";import{N as Ne,a as H}from"./RadioGroup-64dd0ada.js";import{N as Ue}from"./Switch-627aadd0.js";import"./AppPage-e3cb8e40.js";import"./Upload-c098fdfc.js";import"./Image-da15fe39.js";import"./utils-540fee40.js";import"./get-slot-1efb97e5.js";const Be=ae({name:"DynamicTags",common:te,peers:{Input:le,Button:ne,Tag:se,Space:xe},self(){return{inputWidth:"64px"}}}),ke=Be,Fe=M("dynamic-tags",[M("input",{minWidth:"var(--n-input-width)"})]),ze=Object.assign(Object.assign(Object.assign({},J.props),pe),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:u=>u},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),Ae=oe({name:"DynamicTags",props:ze,setup(u){const{mergedClsPrefixRef:y,inlineThemeDisabled:b}=ie(u),{localeRef:_}=Ie("DynamicTags"),v=ue(u),{mergedDisabledRef:r}=v,T=p(""),C=p(!1),a=p(!0),d=p(null),g=J("DynamicTags","-dynamic-tags",Fe,ke,u,y),w=p(u.defaultValue),S=re(u,"value"),R=de(S,w),N=z(()=>_.value.add),U=z(()=>Oe(u.size)),x=z(()=>r.value||!!u.max&&R.value.length>=u.max);function O(l){const{onChange:c,"onUpdate:value":B,onUpdateValue:K}=u,{nTriggerFormInput:Z,nTriggerFormChange:ee}=v;c&&$(c,l),K&&$(K,l),B&&$(B,l),w.value=l,Z(),ee()}function o(l){const c=R.value.slice(0);c.splice(l,1),O(c)}function e(l){switch(l.key){case"Enter":t()}}function t(l){const c=l??T.value;if(c){const B=R.value.slice(0);B.push(u.onCreate(c)),O(B)}C.value=!1,a.value=!0,T.value=""}function h(){t()}function f(){C.value=!0,Q(()=>{var l;(l=d.value)===null||l===void 0||l.focus(),a.value=!1})}const F=z(()=>{const{self:{inputWidth:l}}=g.value;return{"--n-input-width":l}}),m=b?ce("dynamic-tags",void 0,F,u):void 0;return{mergedClsPrefix:y,inputInstRef:d,localizedAdd:N,inputSize:U,inputValue:T,showInput:C,inputForceFocused:a,mergedValue:R,mergedDisabled:r,triggerDisabled:x,handleInputKeyUp:e,handleAddClick:f,handleInputBlur:h,handleCloseClick:o,handleInputConfirm:t,mergedTheme:g,cssVars:b?void 0:F,themeClass:m==null?void 0:m.themeClass,onRender:m==null?void 0:m.onRender}},render(){const{mergedTheme:u,cssVars:y,mergedClsPrefix:b,onRender:_,renderTag:v}=this;return _==null||_(),I(Y,{class:[`${b}-dynamic-tags`,this.themeClass],size:"small",style:y,theme:u.peers.Space,themeOverrides:u.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:r,tagStyle:T,type:C,round:a,size:d,color:g,closable:w,mergedDisabled:S,showInput:R,inputValue:N,inputStyle:U,inputSize:x,inputForceFocused:O,triggerDisabled:o,handleInputKeyUp:e,handleInputBlur:t,handleAddClick:h,handleCloseClick:f,handleInputConfirm:F,$slots:m}=this;return this.mergedValue.map((l,c)=>v?v(l,c):I(X,{key:c,theme:r.peers.Tag,themeOverrides:r.peerOverrides.Tag,style:T,type:C,round:a,size:d,color:g,closable:w,disabled:S,onClose:()=>{f(c)}},{default:()=>typeof l=="string"?l:l.label})).concat(R?m.input?m.input({submit:F,deactivate:t}):I(W,Object.assign({placeholder:"",size:x,style:U,autosize:!0},this.inputProps,{ref:"inputInstRef",value:N,onUpdateValue:l=>{this.inputValue=l},theme:r.peers.Input,themeOverrides:r.peerOverrides.Input,onKeyup:e,onBlur:t,internalForceFocus:O})):m.trigger?m.trigger({activate:h,disabled:o}):I(j,{dashed:!0,disabled:o,theme:r.peers.Button,themeOverrides:r.peerOverrides.Button,size:x,onClick:h},{icon:()=>I(me,{clsPrefix:b},{default:()=>I(Se,null)})}))}})}});const De={class:"mb-15 flex items-center bg-white space-x-10"},$e={key:0,class:"i-line-md:uploading-loop"},Le={key:0,class:"i-line-md:confirm-circle"},Pe=Object.assign({name:"发布文章"},{__name:"index",setup(u){const y=fe(),b=ge(),_=p([]),v=p([]);let r=[];E(y,async()=>b.reloadTag()),he(async()=>{T()}),ye(async()=>{T()});async function T(){S(),A.getCategoryOption().then(o=>{_.value=o.data.map(e=>({value:e.label,label:e.label}))}),A.getTagOption().then(o=>{v.value=o.data.map(e=>({value:e.label,label:e.label})),r=v.value}),await Q()}const C=p(null),a=p({status:1,is_top:0}),d=p(!1),g=p(!1),w=p(null);E(()=>a.value.tag_names,o=>{v.value=r.filter(e=>!o.includes(e.label))},{deep:!0});async function S(){var e,t,h;const o=y.params.id;if(!o){a.value={status:1,is_top:0,title:""};return}(e=window.$loadingBar)==null||e.start();try{const f=await A.getArticleById(o);a.value=f.data,(t=window.$loadingBar)==null||t.finish()}catch{(h=window.$loadingBar)==null||h.error(),$message==null||$message.error("加载失败")}}function R(){$message.info("保存草稿开发中")}function N(){var o,e;if(!a.value.title||!((o=a.value.title)!=null&&o.trim())){a.value.title=(e=a.value.title)==null?void 0:e.trim(),$message.info("请输入标题");return}g.value=!0}async function U(){var o;(o=C.value)==null||o.validate(async e=>{if(!e){d.value=!0;try{await A.saveOrUpdateArticle(a.value),g.value=!1,$message.success("操作成功!"),b.removeTag(y.path)}catch{}finally{d.value=!1}}})}const x={category_name:{required:!0,message:"请选择文章分类",trigger:["blur","change"]},tag_names:{required:!0,message:"请选择文章标签"}};function O(o,e){return I(X,{type:"info",disabled:e>3,closable:!0,onClose:()=>a.value.tag_names.splice(e,1)},{default:()=>o})}return(o,e)=>(D(),q(Te,{"show-header":!1,title:"写文章"},{default:i(()=>[be("div",De,[n(s(W),{value:a.value.title,"onUpdate:value":e[0]||(e[0]=t=>a.value.title=t),type:"text",class:"mr-20 flex-1 py-5 text-18 font-bold color-primary",placeholder:"输入文章标题..."},null,8,["value"]),n(s(j),{ghost:"",type:"error",loading:d.value,onClick:R},{icon:i(()=>[d.value?L("",!0):(D(),G("span",$e))]),default:i(()=>[k(" 保存草稿 ")]),_:1},8,["loading"]),n(s(j),{type:"error",loading:d.value,onClick:N},{icon:i(()=>[d.value?L("",!0):(D(),G("span",Le))]),default:i(()=>[k(" 发布文章 ")]),_:1},8,["loading"])]),n(s(_e),{modelValue:a.value.content,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.content=t),style:{height:"calc(100vh - 305px)"}},null,8,["modelValue"]),n(Ce,{visible:g.value,"onUpdate:visible":e[10]||(e[10]=t=>g.value=t),title:"发布文章",loading:d.value,"show-footer":"",onSave:U},{default:i(()=>[n(s(Ve),{ref_key:"formRef",ref:C,"label-placement":"left","label-align":"left","label-width":100,model:a.value,rules:x},{default:i(()=>[n(s(V),{label:"文章分类",path:"category_name"},{default:i(()=>[n(s(P),{value:a.value.category_name,"onUpdate:value":e[2]||(e[2]=t=>a.value.category_name=t),style:{width:"50%"},clearable:"",filterable:"",tag:"",placeholder:"关键字搜索，enter 添加",options:_.value},null,8,["value","options"])]),_:1}),n(s(V),{label:"文章标签",path:"tag_names"},{default:i(()=>[n(s(Ae),{value:a.value.tag_names,"onUpdate:value":e[4]||(e[4]=t=>a.value.tag_names=t),"render-tag":O,max:3},{input:i(({submit:t,deactivate:h})=>[n(s(P),{value:w.value,"onUpdate:value":[e[3]||(e[3]=f=>w.value=f),f=>{t(f),w.value=null}],size:"small",filterable:"",tag:"",clearable:"",options:v.value,placeholder:"标签名称",onBlur:h},{action:i(()=>[k(" 输入标签名搜索，enter 添加自定义标签 ")]),_:2},1032,["value","options","onUpdate:value","onBlur"])]),_:1},8,["value"])]),_:1}),n(s(V),{label:"文章类型",path:"type"},{default:i(()=>[n(s(P),{value:a.value.type,"onUpdate:value":e[5]||(e[5]=t=>a.value.type=t),style:{width:"50%"},placeholder:"请选择文章分类",options:s(Re)},null,8,["value","options"])]),_:1}),a.value.type===2||a.value.type===3?(D(),q(s(V),{key:0,label:"原文地址",path:"original_url"},{default:i(()=>[n(s(W),{value:a.value.original_url,"onUpdate:value":e[6]||(e[6]=t=>a.value.original_url=t),type:"text",placeholder:"请填写原文连接"},null,8,["value"])]),_:1})):L("",!0),n(s(V),{label:"文章缩略图",path:"img"},{default:i(()=>[n(we,{preview:a.value.img,"onUpdate:preview":e[7]||(e[7]=t=>a.value.img=t),width:220},null,8,["preview"])]),_:1}),n(s(V),{label:"置顶",path:"is_top"},{default:i(()=>[n(s(Ue),{value:a.value.is_top,"onUpdate:value":e[8]||(e[8]=t=>a.value.is_top=t),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1}),n(s(V),{label:"发布形式",path:"status"},{default:i(()=>[n(s(Ne),{value:a.value.status,"onUpdate:value":e[9]||(e[9]=t=>a.value.status=t),name:"radiogroup"},{default:i(()=>[n(s(Y),null,{default:i(()=>[n(s(H),{value:1},{default:i(()=>[k(" 公开 ")]),_:1}),n(s(H),{value:2},{default:i(()=>[k(" 私密 ")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading"])]),_:1}))}}),na=ve(Pe,[["__scopeId","data-v-6f143160"]]);export{na as default};
