import{h as V,g as P,C as j,k as f,x as E,m as p,D as F,o as J,c as K,w as n,a as i,b as y,u as s,d as h,l as L,z as d,E as M,F as S,N as c,A as W,B as g}from"./index-7e9df7d9.js";import{_ as G}from"./CommonPage-7491aea4.js";import{_ as b}from"./QueryItem-0f282244.js";import{_ as H}from"./CrudTable-121684b7.js";import{u as Q}from"./useCRUD-f64dec52.js";import{a as U,b as X}from"./config-7d76553c.js";import{N as Y}from"./Image-77507ba9.js";import{N as Z}from"./Switch-9d808840.js";import{N as ee}from"./Upload-667cd4e3.js";import{N as te,a as v}from"./Tabs-44f6c44d.js";import{N as ae}from"./Input-5db271d7.js";import{N as _}from"./Space-f54cd109.js";import{N as le}from"./Popconfirm-6b45faf2.js";import"./AppPage-848b5b84.js";import"./Checkbox-ac1591ea.js";import"./RadioGroup-757891b8.js";import"./get-slot-1efb97e5.js";import"./Forward-8d8448e7.js";import"./utils-3c01791b.js";import"./Add-3a899e67.js";const ie=h("i",{class:"i-material-symbols:add"},null,-1),se=h("i",{class:"i-material-symbols:recycling-rounded"},null,-1),ne=h("i",{class:"i-mdi:export"},null,-1),re={class:"inline-block"},oe=h("i",{class:"i-mdi:import"},null,-1),ze=Object.assign({name:"文章列表"},{__name:"index",setup(de){const C=V(),T=P(),z=j(),k=f([]),w=f([]),r=f(null),u=f({title:"",type:null,category_id:null,tag_id:null}),o=f({}),{handleDelete:N}=Q({name:"文章",doDelete:B,refresh:()=>{var e;return(e=r.value)==null?void 0:e.handleSearch()}});E(()=>{p.getCategoryOption().then(e=>k.value=e.data),p.getTagOption().then(e=>w.value=e.data),x("all")}),F(()=>{var t;const{needRefresh:e}=C.query;e&&((t=r.value)==null||t.handleSearch())});const A=[{type:"selection",width:20,fixed:"left"},{title:"文章封面",key:"img",width:55,align:"center",render(e){return d(Y,{imgProps:{style:{"border-radius":"2px",height:"100%",width:"100%"}},src:M(e.img),fallbackSrc:"http://dummyimage.com/400x400",showToolbarTooltip:!0})}},{title:"文章标题",key:"title",width:120,align:"center",ellipsis:{tooltip:!0}},{title:"分类",key:"category.name",width:60,align:"center",ellipsis:{tooltip:!0},render(e){return d("div",e.category.name||"无")}},{title:"标签",key:"tags",width:100,align:"center",render(e){const t=e.tags??[],a=[];for(let l=0;l<t.length;l++)a.push(d(S,{type:"info",style:{margin:"2px 3px"}},{default:()=>t[l].name}));return d("div",a.length?a:"无")}},{title:"浏览量",key:"view_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"点赞量",key:"like_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"类型",key:"type",width:50,align:"center",render(e){return d(S,{type:U[e.type].tag},{default:()=>U[e.type].name})}},{title:"发布时间",key:"updateDate",align:"center",width:80,render(e){return d(c,{size:"small",type:"text",ghost:!0},{default:()=>W(e.updated_at),icon:g("mdi:update",{size:18})})}},{title:"置顶",key:"is_top",width:50,align:"center",fixed:"left",render(e){return d(Z,{size:"small",rubberBand:!1,value:e.is_top,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>D(e)})}},{title:"操作",key:"actions",width:120,align:"center",fixed:"right",render(e){return[e.is_delete?d(c,{size:"small",type:"success",secondary:!0,onClick:async()=>{var t;await p.softDeleteArticle({ids:[e.id],is_delete:0}),await((t=r.value)==null?void 0:t.handleSearch())}},{default:()=>"恢复",icon:g("majesticons:eye-line",{size:16})}):d(c,{size:"small",type:"primary",secondary:!0,onClick:()=>T.push(`/article/write/${e.id}`)},{default:()=>"查看",icon:g("majesticons:eye-line",{size:16})}),d(le,{onPositiveClick:()=>N([e.id],!1)},{trigger:()=>d(c,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:g("material-symbols:delete-outline",{size:16})}),default:()=>d("div",{},"确定删除该文章吗?")})]}}];function B(e){o.value.is_delete===0?p.softDeleteArticle({ids:JSON.parse(e),is_delete:1}):p.deleteArticle(e)}async function D(e){var t;e.id&&(e.publishing=!0,e.is_top=e.is_top===0?1:0,await p.updateArticleTop(e),e.publishing=!1,$message==null||$message.success(e.is_top?"已成功置顶":"已取消置顶"),(t=r.value)==null||t.handleSearch())}async function O(e){var a;const t=(a=r.value)==null?void 0:a.tableData.filter(l=>e.includes(l.id));for(const l of t)R(l.content,`${l.title}.md`)}function x(e){var t;switch(e){case"all":o.value.is_delete=0,o.value.status=null;break;case"public":o.value.is_delete=0,o.value.status=1;break;case"secret":o.value.is_delete=0,o.value.status=2;break;case"draft":o.value.is_delete=0,o.value.status=3;break;case"delete":o.value.is_delete=1,o.value.status=null;break}(t=r.value)==null||t.handleSearch()}function q(e){return e.file.name.endsWith(".md")?!0:($message.error("只能上传 .md 格式的文件，请重新上传"),!1)}function I({event:e}){var l;const t=(e==null?void 0:e.target).response;JSON.parse(t).code===0?((l=r.value)==null||l.handleSearch(),$message.success("文章导入成功！")):$message.error("文章导入失败！")}function R(e,t){const a=document.createElement("a");a.download=t,a.style.display="none";const l=new Blob([e]);a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),document.body.removeChild(a)}return(e,t)=>(J(),K(G,{title:"文章列表"},{action:n(()=>{var a,l;return[i(s(c),{type:"primary",onClick:t[0]||(t[0]=$=>e.$router.replace("/article/write"))},{icon:n(()=>[ie]),default:n(()=>[y(" 新建文章 ")]),_:1}),i(s(c),{type:"error",disabled:!((a=r.value)!=null&&a.selections.length),onClick:t[1]||(t[1]=$=>{var m;return s(N)((m=r.value)==null?void 0:m.selections)})},{icon:n(()=>[se]),default:n(()=>[y(" 批量删除 ")]),_:1},8,["disabled"]),i(s(c),{type:"info",disabled:!((l=r.value)!=null&&l.selections.length),onClick:t[2]||(t[2]=$=>{var m;return O((m=r.value)==null?void 0:m.selections)})},{icon:n(()=>[ne]),default:n(()=>[y(" 批量导出 ")]),_:1},8,["disabled"]),h("div",re,[i(s(ee),{action:"/api/article/import",headers:{Authorization:`Bearer ${s(z)}`},"show-file-list":!1,multiple:"",onBeforeUpload:q,onFinish:I},{default:n(()=>[i(s(c),{type:"success"},{icon:n(()=>[oe]),default:n(()=>[y(" 批量导入 ")]),_:1})]),_:1},8,["headers"])])]}),default:n(()=>[i(s(te),{type:"line",animated:"","onUpdate:value":x},{prefix:n(()=>[y(" 状态 ")]),default:n(()=>[i(s(v),{name:"all",tab:"全部"}),i(s(v),{name:"public",tab:"公开"}),i(s(v),{name:"secret",tab:"私密"}),i(s(v),{name:"draft",tab:"草稿箱"}),i(s(v),{name:"delete",tab:"回收站"})]),_:1}),i(H,{ref_key:"$table",ref:r,"query-items":u.value,"onUpdate:queryItems":t[11]||(t[11]=a=>u.value=a),"extra-params":o.value,columns:A,"get-data":s(p).getArticles},{queryBar:n(()=>[i(b,{label:"标题","label-width":40,"content-width":180},{default:n(()=>[i(s(ae),{value:u.value.title,"onUpdate:value":t[3]||(t[3]=a=>u.value.title=a),clearable:"",type:"text",placeholder:"请输入标题",onKeydown:t[4]||(t[4]=L(a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),i(b,{label:"类型","label-width":40,"content-width":160},{default:n(()=>[i(s(_),{value:u.value.type,"onUpdate:value":[t[5]||(t[5]=a=>u.value.type=a),t[6]||(t[6]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",placeholder:"请选择文章类型",options:s(X)},null,8,["value","options"])]),_:1}),i(b,{label:"分类","label-width":40,"content-width":160},{default:n(()=>[i(s(_),{value:u.value.category_id,"onUpdate:value":[t[7]||(t[7]=a=>u.value.category_id=a),t[8]||(t[8]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章分类",options:k.value},null,8,["value","options"])]),_:1}),i(b,{label:"标签","label-width":40,"content-width":160},{default:n(()=>[i(s(_),{value:u.value.tag_id,"onUpdate:value":[t[9]||(t[9]=a=>u.value.tag_id=a),t[10]||(t[10]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章标签",options:w.value},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{ze as default};
