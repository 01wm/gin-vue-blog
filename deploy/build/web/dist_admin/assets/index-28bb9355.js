import{p as x,e as p,o as N,f as $,w as s,l as f,j as r,h as v,i as n,k as C,g as w,s as a,y as I,z as P,N as o,v as U}from"./index-cfa27ed4.js";import{_ as q}from"./CommonPage-4f39ed42.js";import{_ as z}from"./QueryItem-d17f875d.js";import{_ as B}from"./CrudTable-f7b664e6.js";import{u as T}from"./useCRUD-d1880a98.js";import{N as D}from"./Image-8f67d64f.js";import{N as M,a as g}from"./Tabs-87b6ee1c.js";import{N as S}from"./Input-9d39db42.js";import{N as R}from"./Popconfirm-c434d7b3.js";import"./AppPage-a5c29498.js";import"./Space-c006c775.js";import"./RadioGroup-3711a790.js";import"./get-slot-1efb97e5.js";import"./Checkbox-13b79107.js";import"./Forward-d629ea4a.js";import"./utils-cbbf6e0c.js";import"./Add-54f78e8b.js";const V=w("span",{class:"i-material-symbols:recycling-rounded"},null,-1),j=w("span",{class:"i-ic:outline-approval"},null,-1),se=Object.assign({name:"留言管理"},{__name:"index",setup(K){x(()=>{y("all")});const l=p(null),u=p({nickname:""}),d=p({is_review:null}),{handleDelete:h}=T({name:"留言",doDelete:f.deleteMessages,refresh:()=>{var e;return(e=l.value)==null?void 0:e.handleSearch()}}),k=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render(e){return a(D,{height:50,imgProps:{style:{"border-radius":"3px"}},src:I(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"留言人",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"留言内容",key:"content",width:120,align:"center"},{title:"IP 地址",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0}},{title:"IP 来源",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return a("span",e.ip_source||"未知")}},{title:"留言时间",key:"created_at",align:"center",width:80,render(e){return a(o,{size:"small",type:"text",ghost:!0},{default:()=>U(e.created_at),icon:()=>a("i",{class:"i-mdi:update"})})}},{title:"状态",key:"is_review",width:50,align:"center",render(e){return a(P,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(e){return[e.is_review?a(o,{size:"small",type:"warning",onClick:()=>m([e.id],0)},{default:()=>"撤下",icon:()=>a("i",{class:"i-mi:circle-error"})}):a(o,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>m([e.id],1)},{default:()=>"通过",icon:()=>a("i",{class:"i-mi:circle-check"})}),a(R,{onPositiveClick:()=>h([e.id],!1)},{trigger:()=>a(o,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:()=>a("i",{class:"i-material-symbols:delete-outline"})}),default:()=>a("div",{},"确定删除该条留言吗?")})]}}];async function m(e,t){var i;if(!e.length){$message.info("请选择要审核的数据");return}await f.updateMessageReview({ids:e,is_review:t}),$message==null||$message.success(t?"审核成功":"撤下成功"),(i=l.value)==null||i.handleSearch()}function y(e){var t;switch(e){case"all":d.value.is_review=null;break;case"has_review":d.value.is_review=1;break;case"not_review":d.value.is_review=0;break}(t=l.value)==null||t.handleSearch()}return(e,t)=>(N(),$(q,{title:"留言管理"},{action:s(()=>{var i,c;return[r(n(o),{type:"error",disabled:!((i=l.value)!=null&&i.selections.length),onClick:t[0]||(t[0]=b=>{var _;return n(h)((_=l.value)==null?void 0:_.selections)})},{icon:s(()=>[V]),default:s(()=>[v(" 批量删除 ")]),_:1},8,["disabled"]),r(n(o),{type:"success",disabled:!((c=l.value)!=null&&c.selections.length),onClick:t[1]||(t[1]=b=>m(l.value.selections,1))},{icon:s(()=>[j]),default:s(()=>[v(" 批量通过 ")]),_:1},8,["disabled"])]}),default:s(()=>[r(n(M),{type:"line",animated:"","onUpdate:value":y},{prefix:s(()=>[v(" 状态 ")]),default:s(()=>[r(n(g),{name:"all",tab:"全部"}),r(n(g),{name:"has_review",tab:"通过"}),r(n(g),{name:"not_review",tab:"审核中"})]),_:1}),r(B,{ref_key:"$table",ref:l,"query-items":u.value,"onUpdate:queryItems":t[4]||(t[4]=i=>u.value=i),"extra-params":d.value,columns:k,"get-data":n(f).getMessages},{queryBar:s(()=>[r(z,{label:"用户","label-width":40,"content-width":180},{default:s(()=>[r(n(S),{value:u.value.nickname,"onUpdate:value":t[2]||(t[2]=i=>u.value.nickname=i),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:t[3]||(t[3]=C(i=>{var c;return(c=l.value)==null?void 0:c.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{se as default};
