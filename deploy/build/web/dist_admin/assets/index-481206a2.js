import{c as R,b as V,e as f,p as j,l as p,x as I,o as P,f as E,w as s,j as i,h as y,i as n,g,k as F,s as o,y as J,z as $,N as c,v as K}from"./index-7d3bcf57.js";import{_ as L}from"./CommonPage-60900c13.js";import{_ as h}from"./QueryItem-c84c912a.js";import{_ as M}from"./CrudTable-706359a4.js";import{u as W}from"./useCRUD-87b8d7a3.js";import{a as S,b as G}from"./config-7d76553c.js";import{N as H}from"./Image-da15fe39.js";import{N as Q}from"./Switch-627aadd0.js";import{N as X}from"./Upload-c098fdfc.js";import{N as Y,a as v}from"./Tabs-aa5b26a3.js";import{N as Z}from"./Input-41b621cb.js";import{N as b}from"./Space-dcdf9175.js";import{N as ee}from"./Popconfirm-a41de709.js";import"./AppPage-e3cb8e40.js";import"./Checkbox-b4c2fca7.js";import"./RadioGroup-64dd0ada.js";import"./get-slot-1efb97e5.js";import"./Forward-47c9bfa7.js";import"./utils-540fee40.js";import"./Add-58674542.js";const te=g("i",{class:"i-material-symbols:add"},null,-1),ae=g("i",{class:"i-material-symbols:recycling-rounded"},null,-1),le=g("i",{class:"i-mdi:export"},null,-1),ie={class:"inline-block"},se=g("i",{class:"i-mdi:import"},null,-1),Ue=Object.assign({name:"文章列表"},{__name:"index",setup(ne){const U=R(),C=V(),_=f([]),k=f([]),r=f(null),d=f({title:"",type:null,category_id:null,tag_id:null}),u=f({is_delete:null,status:null}),{handleDelete:w}=W({name:"文章",doDelete:O,refresh:()=>{var e;return(e=r.value)==null?void 0:e.handleSearch()}});j(()=>{p.getCategoryOption().then(e=>_.value=e.data),p.getTagOption().then(e=>k.value=e.data),N("all")}),I(()=>{var t;const{needRefresh:e}=U.query;e&&((t=r.value)==null||t.handleSearch())});const T=[{type:"selection",width:20,fixed:"left"},{title:"文章封面",key:"img",width:55,align:"center",render(e){return o(H,{imgProps:{style:{"border-radius":"2px",height:"100%",width:"100%"}},src:J(e.img),fallbackSrc:"http://dummyimage.com/400x400",showToolbarTooltip:!0})}},{title:"文章标题",key:"title",width:120,align:"center",ellipsis:{tooltip:!0}},{title:"分类",key:"category.name",width:60,align:"center",ellipsis:{tooltip:!0},render(e){return o("div",e.category.name||"无")}},{title:"标签",key:"tags",width:100,align:"center",render(e){const t=e.tags??[],a=[];for(let l=0;l<t.length;l++)a.push(o($,{type:"info",style:{margin:"2px 3px"}},{default:()=>t[l].name}));return o("div",a.length?a:"无")}},{title:"浏览量",key:"view_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"点赞量",key:"like_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"类型",key:"type",width:50,align:"center",render(e){return o($,{type:S[e.type].tag},{default:()=>S[e.type].name})}},{title:"发布时间",key:"updateDate",align:"center",width:80,render(e){return o(c,{size:"small",type:"text",ghost:!0},{default:()=>K(e.updated_at),icon:()=>o("i",{class:"i-mdi:update"})})}},{title:"置顶",key:"is_top",width:50,align:"center",fixed:"left",render(e){return o(Q,{size:"small",rubberBand:!1,value:e.is_top,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>D(e)})}},{title:"操作",key:"actions",width:120,align:"center",fixed:"right",render(e){return[e.is_delete?o(c,{size:"small",type:"success",secondary:!0,onClick:async()=>{var t;await p.softDeleteArticle({ids:[e.id],is_delete:0}),await((t=r.value)==null?void 0:t.handleSearch())}},{default:()=>"恢复",icon:()=>o("i",{class:"i-majesticons:eye-line"})}):o(c,{size:"small",type:"primary",secondary:!0,onClick:()=>C.push(`/article/write/${e.id}`)},{default:()=>"查看",icon:()=>o("i",{class:"i-majesticons:eye-line"})}),o(ee,{onPositiveClick:()=>w([e.id],!1)},{trigger:()=>o(c,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:()=>o("i",{class:"i-material-symbols:delete-outline"})}),default:()=>o("div",{},"确定删除该文章吗?")})]}}];function O(e){u.value.is_delete===0?p.softDeleteArticle({ids:JSON.parse(e),is_delete:1}):p.deleteArticle(e)}async function D(e){var t;e.id&&(e.publishing=!0,e.is_top=e.is_top===0?1:0,await p.updateArticleTop(e),e.publishing=!1,$message==null||$message.success(e.is_top?"已成功置顶":"已取消置顶"),(t=r.value)==null||t.handleSearch())}async function A(e){var a;const t=(a=r.value)==null?void 0:a.tableData.filter(l=>e.includes(l.id));for(const l of t)z(l.content,`${l.title}.md`)}function N(e){var t;switch(e){case"all":u.value.is_delete=0,u.value.status=null;break;case"public":u.value.is_delete=0,u.value.status=1;break;case"secret":u.value.is_delete=0,u.value.status=2;break;case"draft":u.value.is_delete=0,u.value.status=3;break;case"delete":u.value.is_delete=1,u.value.status=null;break}(t=r.value)==null||t.handleSearch()}function B(e){return e.file.name.endsWith(".md")?!0:($message.error("只能上传 .md 格式的文件，请重新上传"),!1)}function q({event:e}){var l;const t=(e==null?void 0:e.target).response;JSON.parse(t).code===0?((l=r.value)==null||l.handleSearch(),$message.success("文章导入成功！")):$message.error("文章导入失败！")}function z(e,t){const a=document.createElement("a");a.download=t,a.style.display="none";const l=new Blob([e]);a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),document.body.removeChild(a)}return(e,t)=>(P(),E(L,{title:"文章列表"},{action:s(()=>{var a,l;return[i(n(c),{type:"primary",onClick:t[0]||(t[0]=x=>e.$router.replace("/article/write"))},{icon:s(()=>[te]),default:s(()=>[y(" 新建文章 ")]),_:1}),i(n(c),{type:"error",disabled:!((a=r.value)!=null&&a.selections.length),onClick:t[1]||(t[1]=x=>{var m;return n(w)((m=r.value)==null?void 0:m.selections)})},{icon:s(()=>[ae]),default:s(()=>[y(" 批量删除 ")]),_:1},8,["disabled"]),i(n(c),{type:"info",disabled:!((l=r.value)!=null&&l.selections.length),onClick:t[2]||(t[2]=x=>{var m;return A((m=r.value)==null?void 0:m.selections)})},{icon:s(()=>[le]),default:s(()=>[y(" 批量导出 ")]),_:1},8,["disabled"]),g("div",ie,[i(n(X),{action:"/api/article/import","show-file-list":!1,multiple:"",onBeforeUpload:B,onFinish:q},{default:s(()=>[i(n(c),{type:"success"},{icon:s(()=>[se]),default:s(()=>[y(" 批量导入 ")]),_:1})]),_:1})])]}),default:s(()=>[i(n(Y),{type:"line",animated:"","onUpdate:value":N},{prefix:s(()=>[y(" 状态 ")]),default:s(()=>[i(n(v),{name:"all",tab:"全部"}),i(n(v),{name:"public",tab:"公开"}),i(n(v),{name:"secret",tab:"私密"}),i(n(v),{name:"draft",tab:"草稿箱"}),i(n(v),{name:"delete",tab:"回收站"})]),_:1}),i(M,{ref_key:"$table",ref:r,"query-items":d.value,"onUpdate:queryItems":t[11]||(t[11]=a=>d.value=a),"extra-params":u.value,columns:T,"get-data":n(p).getArticles},{queryBar:s(()=>[i(h,{label:"标题","label-width":40,"content-width":180},{default:s(()=>[i(n(Z),{value:d.value.title,"onUpdate:value":t[3]||(t[3]=a=>d.value.title=a),clearable:"",type:"text",placeholder:"请输入标题",onKeydown:t[4]||(t[4]=F(a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),i(h,{label:"类型","label-width":40,"content-width":160},{default:s(()=>[i(n(b),{value:d.value.type,"onUpdate:value":[t[5]||(t[5]=a=>d.value.type=a),t[6]||(t[6]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",placeholder:"请选择文章类型",options:n(G)},null,8,["value","options"])]),_:1}),i(h,{label:"分类","label-width":40,"content-width":160},{default:s(()=>[i(n(b),{value:d.value.category_id,"onUpdate:value":[t[7]||(t[7]=a=>d.value.category_id=a),t[8]||(t[8]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章分类",options:_.value},null,8,["value","options"])]),_:1}),i(h,{label:"标签","label-width":40,"content-width":160},{default:s(()=>[i(n(b),{value:d.value.tag_id,"onUpdate:value":[t[9]||(t[9]=a=>d.value.tag_id=a),t[10]||(t[10]=a=>{var l;return(l=r.value)==null?void 0:l.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章标签",options:k.value},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{Ue as default};
