import{e as f,p as B,l as p,o as c,f as b,w as n,j as r,i as t,k as F,W as z,a8 as C,a7 as R,q as V,s as i,y as D,z as v,v as _,N as g}from"./index-cfa27ed4.js";import{_ as O}from"./CommonPage-4f39ed42.js";import{_ as h}from"./QueryItem-d17f875d.js";import{_ as T}from"./CrudModal-388e823f.js";import{_ as j}from"./CrudTable-f7b664e6.js";import{l as k,e as E}from"./config-7d76553c.js";import{u as K}from"./useCRUD-d1880a98.js";import{a as L,N as M}from"./Checkbox-13b79107.js";import{N as P}from"./Image-8f67d64f.js";import{N as G}from"./Switch-9d78124c.js";import{N}from"./Input-9d39db42.js";import{N as W,b as A}from"./Space-c006c775.js";import{N as H,a as x}from"./FormItem-0c6ab39e.js";import"./AppPage-a5c29498.js";import"./RadioGroup-3711a790.js";import"./get-slot-1efb97e5.js";import"./Forward-d629ea4a.js";import"./utils-cbbf6e0c.js";const ce=Object.assign({name:"用户列表"},{__name:"index",setup(J){const o=f(null),d=f({nickname:"",login_type:""}),{modalVisible:m,modalLoading:U,handleSave:S,handleEdit:$,modalForm:u,modalFormRef:w}=K({name:"用户",doUpdate:p.updateUser,refresh:()=>{var e;return(e=o.value)==null?void 0:e.handleSearch()}}),y=f([]);B(()=>{var e;p.getRoleOption().then(a=>y.value=a.data),(e=o.value)==null||e.handleSearch()});const I=[{title:"头像",key:"avatar",width:50,align:"center",render(e){return i(P,{height:50,imgProps:{style:{"border-radius":"3px"}},src:D(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"昵称",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"登录方式",key:"login_type",width:40,align:"center",render(e){return i(v,{type:k[e.login_type].tag},{default:()=>k[e.login_type].name})}},{title:"用户角色",key:"role",width:80,align:"center",render(e){const a=e.roles??[],l=[];for(let s=0;s<a.length;s++)l.push(i(v,{type:"info",style:{margin:"2px 3px"}},{default:()=>a[s].name}));return i("span",l)}},{title:"登录 IP",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return i("span",e.ip_address||"未知")}},{title:"登录地址",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return i("span",e.ip_source||"未知")}},{title:"创建时间",key:"created_at",align:"center",width:70,render(e){return i(g,{size:"small",type:"text",ghost:!0},{default:()=>_(e.created_at),icon:()=>i("i",{class:"i-mdi:update"})})}},{title:"上次登录时间",key:"last_login_time",align:"center",width:70,render(e){return i(g,{size:"small",type:"text",ghost:!0},{default:()=>_(e.last_login_time),icon:()=>i("i",{class:"i-mdi:update"})})}},{title:"禁用",key:"is_disable",width:30,align:"center",fixed:"left",render(e){return i(G,{size:"small",rubberBand:!1,value:e.is_disable,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>q(e)})}},{title:"操作",key:"actions",width:60,align:"center",fixed:"right",render(e){return[i(g,{size:"small",type:"primary",onClick:()=>{e.role_ids=e.roles.map(a=>a.id),$(e)}},{default:()=>"编辑",icon:()=>i("i",{class:"i-material-symbols:delete-outline"})})]}}];async function q(e){var a;if(e.id){e.publishing=!0,e.is_disable=e.is_disable===0?1:0;try{await p.updateUserDisable(e),$message==null||$message.success(e.is_disable?"已禁用该用户":"已取消禁用该用户"),(a=o.value)==null||a.handleSearch()}catch{e.is_disable=e.is_disable===0?1:0}finally{e.publishing=!1}}}return(e,a)=>(c(),b(O,{title:"用户列表"},{default:n(()=>[r(j,{ref_key:"$table",ref:o,"query-items":d.value,"onUpdate:queryItems":a[4]||(a[4]=l=>d.value=l),columns:I,"get-data":t(p).getUsers},{queryBar:n(()=>[r(h,{label:"昵称","label-width":40},{default:n(()=>[r(t(N),{value:d.value.nickname,"onUpdate:value":a[0]||(a[0]=l=>d.value.nickname=l),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:a[1]||(a[1]=F(l=>{var s;return(s=o.value)==null?void 0:s.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),r(h,{label:"登录方式","label-width":70,"content-width":180},{default:n(()=>[r(t(W),{value:d.value.login_type,"onUpdate:value":[a[2]||(a[2]=l=>d.value.login_type=l),a[3]||(a[3]=l=>{var s;return(s=o.value)==null?void 0:s.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择登录方式",options:t(E)},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","get-data"]),r(T,{visible:t(m),"onUpdate:visible":a[7]||(a[7]=l=>V(m)?m.value=l:null),title:"修改用户",loading:t(U),onSave:t(S)},{default:n(()=>[r(t(H),{ref_key:"modalFormRef",ref:w,"label-placement":"left","label-align":"left","label-width":80,model:t(u)},{default:n(()=>[r(t(x),{label:"用户昵称",path:"name"},{default:n(()=>[r(t(N),{value:t(u).nickname,"onUpdate:value":a[5]||(a[5]=l=>t(u).nickname=l),clearable:"",placeholder:"请输入用户昵称"},null,8,["value"])]),_:1}),r(t(x),{label:"角色",path:"role_ids"},{default:n(()=>[r(t(L),{value:t(u).role_ids,"onUpdate:value":a[6]||(a[6]=l=>t(u).role_ids=l)},{default:n(()=>[r(t(A),{"item-style":"display: flex;"},{default:n(()=>[(c(!0),z(R,null,C(y.value,l=>(c(),b(t(M),{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading","onSave"])]),_:1}))}});export{ce as default};
