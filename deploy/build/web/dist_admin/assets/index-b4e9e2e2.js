import{e as h,p as P,o as N,f as z,w as n,l as u,j as t,h as q,i as a,k as A,W as O,a8 as w,a7 as G,q as I,g as L,s,z as j,v as K,N as p,t as W}from"./index-7d3bcf57.js";import{_ as H}from"./CommonPage-60900c13.js";import{_ as J}from"./QueryItem-c84c912a.js";import{_ as U}from"./CrudModal-d5d9f5ee.js";import{_ as Q}from"./CrudTable-706359a4.js";import{u as X}from"./useCRUD-87b8d7a3.js";import{N as Y}from"./GradientText-770aad9f.js";import{N as Z}from"./Switch-627aadd0.js";import{N as c}from"./Input-41b621cb.js";import{N as S,a as v}from"./FormItem-f3617c31.js";import{N as ee,a as ae}from"./RadioGroup-64dd0ada.js";import{b as le}from"./Space-dcdf9175.js";import{N as te}from"./Popconfirm-a41de709.js";import"./AppPage-e3cb8e40.js";import"./Checkbox-b4c2fca7.js";import"./Forward-47c9bfa7.js";import"./get-slot-1efb97e5.js";const ie=L("span",{class:"i-material-symbols:add"},null,-1),qe=Object.assign({name:"接口管理"},{__name:"index",setup(ne){const d=h(null),m=h({keyword:""}),{modalVisible:f,modalAction:y,modalTitle:T,modalLoading:R,handleAdd:E,handleDelete:$,handleEdit:x,handleSave:_,modalForm:r,modalFormRef:b}=X({name:"接口",doCreate:u.saveOrUpdateResource,doDelete:u.deleteResource,doUpdate:u.saveOrUpdateResource,refresh:()=>{var e;return(e=d.value)==null?void 0:e.handleSearch()}});P(()=>{var e;(e=d.value)==null||e.handleSearch()});const V=["GET","POST","DELETE","PUT"];function g(e){switch(e){case"GET":return"info";case"POST":return"success";case"PUT":return"warning";case"DELETE":return"error";default:return"info"}}const B=[{title:"资源名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"资源路径",key:"url",width:100,ellipsis:{tooltip:!0}},{title:"请求方式",key:"request_method",width:50,align:"center",render(e){return e.children?"":s(j,{type:g(e.request_method)},{default:()=>e.request_method})}},{title:"匿名访问",key:"is_hidden",width:50,align:"center",fixed:"left",render(e){return e.children?"":s(Z,{size:"small",rubberBand:!1,value:e.is_anonymous,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>C(e)})}},{title:"创建日期",key:"created_at",width:60,render(e){return s("span",K(e.created_at))}},{title:"操作",key:"actions",width:115,align:"center",fixed:"right",render(e){return[s(p,{size:"tiny",quaternary:!0,type:"primary",style:`display: ${e.children?"":"none"};`,onClick:()=>{E(),r.value.parent_id=e.id}},{default:()=>"新增",icon:()=>s("i",{class:"i-material-symbols:add"})}),s(p,{size:"tiny",quaternary:!0,type:"info",onClick:()=>e.children?F(e):x(e)},{default:()=>"编辑",icon:()=>s("i",{class:"i-material-symbols:edit-outline"})}),s(te,{onPositiveClick:()=>{$(e.id,!1)}},{trigger:()=>s(p,{size:"tiny",quaternary:!0,type:"error"},{default:()=>"删除",icon:()=>s("i",{class:"i-material-symbols:delete-outline"})}),default:()=>s("div",{},"确定删除该接口吗?")})]}}];async function C(e){e.id&&(e.publishing=!0,e.is_anonymous=e.is_anonymous===0?1:0,await u.updateResourceAnonymous(e),e.publishing=!1,$message==null||$message.success(e.is_anonymous?"已允许匿名访问":"已禁止匿名访问"))}const o=h(!1);function D(){y.value="add",r.value={},o.value=!0}function F(e){y.value="edit",r.value={...e},o.value=!0}async function M(){_(),o.value=!1}return(e,i)=>(N(),z(H,{title:"接口管理"},{action:n(()=>[t(a(p),{type:"primary",onClick:D},{icon:n(()=>[ie]),default:n(()=>[q(" 新增模块 ")]),_:1})]),default:n(()=>[t(Q,{ref_key:"$table",ref:d,"query-items":m.value,"onUpdate:queryItems":i[2]||(i[2]=l=>m.value=l),"is-pagination":!1,columns:B,"get-data":a(u).getResources,"single-line":!0},{queryBar:n(()=>[t(J,{label:"资源名","label-width":50},{default:n(()=>[t(a(c),{value:m.value.keyword,"onUpdate:value":i[0]||(i[0]=l=>m.value.keyword=l),clearable:"",type:"text",placeholder:"请输入资源名",onKeydown:i[1]||(i[1]=A(l=>{var k;return(k=d.value)==null?void 0:k.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),t(U,{visible:a(f),"onUpdate:visible":i[6]||(i[6]=l=>I(f)?f.value=l:null),title:a(T),loading:a(R),onSave:a(_)},{default:n(()=>[t(a(S),{ref_key:"modalFormRef",ref:b,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:n(()=>[t(a(v),{label:"资源名",path:"name"},{default:n(()=>[t(a(c),{value:a(r).name,"onUpdate:value":i[3]||(i[3]=l=>a(r).name=l),placeholder:"请输入资源名"},null,8,["value"])]),_:1}),t(a(v),{label:"资源路径",path:"url"},{default:n(()=>[t(a(c),{value:a(r).url,"onUpdate:value":i[4]||(i[4]=l=>a(r).url=l),placeholder:"请输入资源路径"},null,8,["value"])]),_:1}),t(a(v),{label:"请求方式",path:"request_method"},{default:n(()=>[t(a(ee),{value:a(r).request_method,"onUpdate:value":i[5]||(i[5]=l=>a(r).request_method=l),name:"radiogroup"},{default:n(()=>[t(a(le),null,{default:n(()=>[(N(),O(G,null,w(V,l=>t(a(ae),{key:l,value:l},{default:n(()=>[t(a(Y),{type:g(l)},{default:n(()=>[q(W(l),1)]),_:2},1032,["type"])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"]),t(U,{visible:o.value,"onUpdate:visible":i[8]||(i[8]=l=>o.value=l),title:`${a(y)==="add"?"新增":"编辑"}模块`,loading:a(f),onSave:M},{default:n(()=>[t(a(S),{ref_key:"modalFormRef",ref:b,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:n(()=>[t(a(v),{label:"模块名",path:"name"},{default:n(()=>[t(a(c),{value:a(r).name,"onUpdate:value":i[7]||(i[7]=l=>a(r).name=l),placeholder:"请输入模块名"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1}))}});export{qe as default};
