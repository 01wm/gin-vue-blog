import{k as f,x as F,m as p,o as c,c as _,w as r,a as i,u as l,l as q,a1 as C,ae as R,ad as V,y as D,z as n,E as O,F as v,A as h,B as g,N as y}from"./index-7e9df7d9.js";import{_ as E}from"./CommonPage-7491aea4.js";import{_ as k}from"./QueryItem-0f282244.js";import{_ as T}from"./CrudModal-d60ad9bd.js";import{_ as K}from"./CrudTable-121684b7.js";import{l as N,e as L}from"./config-7d76553c.js";import{u as M}from"./useCRUD-f64dec52.js";import{a as P,N as j}from"./Checkbox-ac1591ea.js";import{N as A}from"./Image-77507ba9.js";import{N as G}from"./Switch-9d808840.js";import{N as x}from"./Input-5db271d7.js";import{N as H,b as J}from"./Space-f54cd109.js";import{N as Q,a as U}from"./FormItem-e99f0659.js";import"./AppPage-848b5b84.js";import"./RadioGroup-757891b8.js";import"./get-slot-1efb97e5.js";import"./Forward-8d8448e7.js";import"./utils-3c01791b.js";const ge=Object.assign({name:"用户列表"},{__name:"index",setup(W){const o=f(null),d=f({nickname:"",login_type:""}),{modalVisible:m,modalLoading:S,handleSave:$,handleEdit:w,modalForm:u,modalFormRef:I}=M({name:"用户",doUpdate:p.updateUser,refresh:()=>{var e;return(e=o.value)==null?void 0:e.handleSearch()}}),b=f([]);F(()=>{var e;p.getRoleOption().then(a=>b.value=a.data),(e=o.value)==null||e.handleSearch()});const z=[{title:"头像",key:"avatar",width:50,align:"center",render(e){return n(A,{height:50,imgProps:{style:{"border-radius":"3px"}},src:O(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"昵称",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"登录方式",key:"login_type",width:40,align:"center",render(e){return n(v,{type:N[e.login_type].tag},{default:()=>N[e.login_type].name})}},{title:"用户角色",key:"role",width:80,align:"center",render(e){const a=e.roles??[],t=[];for(let s=0;s<a.length;s++)t.push(n(v,{type:"info",style:{margin:"2px 3px"}},{default:()=>a[s].name}));return n("span",t)}},{title:"登录 IP",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return n("span",e.ip_address||"未知")}},{title:"登录地址",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return n("span",e.ip_source||"未知")}},{title:"创建时间",key:"created_at",align:"center",width:70,render(e){return n(y,{size:"small",type:"text",ghost:!0},{default:()=>h(e.created_at),icon:g("mdi:update",{size:18})})}},{title:"上次登录时间",key:"last_login_time",align:"center",width:70,render(e){return n(y,{size:"small",type:"text",ghost:!0},{default:()=>h(e.last_login_time),icon:g("mdi:update",{size:18})})}},{title:"禁用",key:"is_disable",width:30,align:"center",fixed:"left",render(e){return n(G,{size:"small",rubberBand:!1,value:e.is_disable,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>B(e)})}},{title:"操作",key:"actions",width:60,align:"center",fixed:"right",render(e){return[n(y,{size:"small",type:"primary",onClick:()=>{e.role_ids=e.roles.map(a=>a.id),w(e)}},{default:()=>"编辑",icon:g("material-symbols:delete-outline",{})})]}}];async function B(e){var a;if(e.id){e.publishing=!0,e.is_disable=e.is_disable===0?1:0;try{await p.updateUserDisable(e),$message==null||$message.success(e.is_disable?"已禁用该用户":"已取消禁用该用户"),(a=o.value)==null||a.handleSearch()}catch{e.is_disable=e.is_disable===0?1:0}finally{e.publishing=!1}}}return(e,a)=>(c(),_(E,{title:"用户列表"},{default:r(()=>[i(K,{ref_key:"$table",ref:o,"query-items":d.value,"onUpdate:queryItems":a[4]||(a[4]=t=>d.value=t),columns:z,"get-data":l(p).getUsers},{queryBar:r(()=>[i(k,{label:"昵称","label-width":40},{default:r(()=>[i(l(x),{value:d.value.nickname,"onUpdate:value":a[0]||(a[0]=t=>d.value.nickname=t),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:a[1]||(a[1]=q(t=>{var s;return(s=o.value)==null?void 0:s.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),i(k,{label:"登录方式","label-width":70,"content-width":180},{default:r(()=>[i(l(H),{value:d.value.login_type,"onUpdate:value":[a[2]||(a[2]=t=>d.value.login_type=t),a[3]||(a[3]=t=>{var s;return(s=o.value)==null?void 0:s.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择登录方式",options:l(L)},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","get-data"]),i(T,{visible:l(m),"onUpdate:visible":a[7]||(a[7]=t=>D(m)?m.value=t:null),title:"修改用户",loading:l(S),onSave:l($)},{default:r(()=>[i(l(Q),{ref_key:"modalFormRef",ref:I,"label-placement":"left","label-align":"left","label-width":80,model:l(u)},{default:r(()=>[i(l(U),{label:"用户昵称",path:"name"},{default:r(()=>[i(l(x),{value:l(u).nickname,"onUpdate:value":a[5]||(a[5]=t=>l(u).nickname=t),clearable:"",placeholder:"请输入用户昵称"},null,8,["value"])]),_:1}),i(l(U),{label:"角色",path:"role_ids"},{default:r(()=>[i(l(P),{value:l(u).role_ids,"onUpdate:value":a[6]||(a[6]=t=>l(u).role_ids=t)},{default:r(()=>[i(l(J),{"item-style":"display: flex;"},{default:r(()=>[(c(!0),C(V,null,R(b.value,t=>(c(),_(l(j),{key:t.value,value:t.value,label:t.label},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading","onSave"])]),_:1}))}});export{ge as default};
