import{k as c,T as R}from"./index-7e9df7d9.js";function S(d={}){const u=c(null),f=c({...d});return{formRef:u,formModel:f,validation:async()=>{var s;try{return await((s=u.value)==null?void 0:s.validate()),!0}catch{return!1}},rules:{required:{required:!0,message:"此为必填项",trigger:["blur","change"]}}}}const T={view:"查看",edit:"编辑",add:"新增"};function C({name:d,initForm:u={},doCreate:f,doDelete:v,doUpdate:m,refresh:s}){const a=c(!1),t=c(""),r=c(!1),w=R(()=>T[t.value]+d),{formModel:o,formRef:g,validation:y}=S(u);function h(){t.value="add",a.value=!0,o.value={...u}}function p(e){t.value="edit",a.value=!0,o.value={...e}}function b(e){t.value="view",a.value=!0,o.value={...e}}async function A(){if(!["edit","add"].includes(t.value)){a.value=!1;return}if(!await y())return!1;const i={add:{api:()=>f(o.value),cb:()=>window.$message.success("新增成功")},edit:{api:()=>m(o.value),cb:()=>window.$message.success("编辑成功")}}[t.value];try{r.value=!0;const l=await i.api();i.cb(),r.value=a.value=!1,l&&s(l)}catch{r.value=!1}}async function $(e,i=!0){if(!e||Array.isArray(e)&&!e.length){window.$message.info("请选择要删除的数据");return}const l=async()=>{try{r.value=!0;let n;typeof e=="number"||typeof e=="string"?n=await v(e):n=await v(JSON.stringify(e)),(n==null?void 0:n.code)===0&&window.$message.success("删除成功"),r.value=!1,s(n)}catch{r.value=!1}};i?window.$dialog.confirm({content:"确定删除？",confirm:()=>l()}):l()}return{modalVisible:a,modalAction:t,modalTitle:w,modalLoading:r,handleAdd:h,handleDelete:$,handleEdit:p,handleView:b,handleSave:A,modalForm:o,modalFormRef:g}}export{C as u};
