import{k as _,x as M,o as U,c as P,w as i,m as u,a as l,b as q,u as a,l as I,a1 as O,ae as w,ad as G,y as L,d as K,z as o,F as j,A as H,N as p,t as J,B as h}from"./index-7e9df7d9.js";import{_ as Q}from"./CommonPage-7491aea4.js";import{_ as W}from"./QueryItem-0f282244.js";import{_ as S}from"./CrudModal-d60ad9bd.js";import{_ as X}from"./CrudTable-121684b7.js";import{u as Y}from"./useCRUD-f64dec52.js";import{N as Z}from"./GradientText-0f3fdecb.js";import{N as ee}from"./Switch-9d808840.js";import{N as y}from"./Input-5db271d7.js";import{N as T,a as c}from"./FormItem-e99f0659.js";import{N as ae,a as te}from"./RadioGroup-757891b8.js";import{b as le}from"./Space-f54cd109.js";import{N as ne}from"./Popconfirm-6b45faf2.js";import"./AppPage-848b5b84.js";import"./Checkbox-ac1591ea.js";import"./Forward-8d8448e7.js";import"./get-slot-1efb97e5.js";const ie=K("span",{class:"i-material-symbols:add"},null,-1),qe=Object.assign({name:"接口管理"},{__name:"index",setup(re){const d=_(null),m=_({keyword:""}),{modalVisible:f,modalAction:v,modalTitle:R,modalLoading:E,handleAdd:x,handleDelete:$,handleEdit:z,handleSave:b,modalForm:r,modalFormRef:g}=Y({name:"接口",doCreate:u.saveOrUpdateResource,doDelete:u.deleteResource,doUpdate:u.saveOrUpdateResource,refresh:()=>{var e;return(e=d.value)==null?void 0:e.handleSearch()}});M(()=>{var e;(e=d.value)==null||e.handleSearch()});const B=["GET","POST","DELETE","PUT"];function k(e){switch(e){case"GET":return"info";case"POST":return"success";case"PUT":return"warning";case"DELETE":return"error";default:return"info"}}const F=[{title:"资源名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"资源路径",key:"url",width:100,ellipsis:{tooltip:!0}},{title:"请求方式",key:"request_method",width:50,align:"center",render(e){return e.children?"":o(j,{type:k(e.request_method)},{default:()=>e.request_method})}},{title:"匿名访问",key:"is_hidden",width:50,align:"center",fixed:"left",render(e){return e.children?"":o(ee,{size:"small",rubberBand:!1,value:e.is_anonymous,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>V(e)})}},{title:"创建日期",key:"created_at",width:60,render(e){return o("span",H(e.created_at))}},{title:"操作",key:"actions",width:115,align:"center",fixed:"right",render(e){return[o(p,{size:"tiny",quaternary:!0,type:"primary",style:`display: ${e.children?"":"none"};`,onClick:()=>{x(),r.value.parent_id=e.id}},{default:()=>"新增",icon:h("material-symbols:add",{size:16})}),o(p,{size:"tiny",quaternary:!0,type:"info",onClick:()=>e.children?D(e):z(e)},{default:()=>"编辑",icon:h("material-symbols:edit-outline",{size:16})}),o(ne,{onPositiveClick:()=>{$(e.id,!1)}},{trigger:()=>o(p,{size:"tiny",quaternary:!0,type:"error"},{default:()=>"删除",icon:h("material-symbols:delete-outline",{size:16})}),default:()=>o("div",{},"确定删除该接口吗?")})]}}];async function V(e){e.id&&(e.publishing=!0,e.is_anonymous=e.is_anonymous===0?1:0,await u.updateResourceAnonymous(e),e.publishing=!1,$message==null||$message.success(e.is_anonymous?"已允许匿名访问":"已禁止匿名访问"))}const s=_(!1);function C(){v.value="add",r.value={},s.value=!0}function D(e){v.value="edit",r.value={...e},s.value=!0}async function A(){b(),s.value=!1}return(e,n)=>(U(),P(Q,{title:"接口管理"},{action:i(()=>[l(a(p),{type:"primary",onClick:C},{icon:i(()=>[ie]),default:i(()=>[q(" 新增模块 ")]),_:1})]),default:i(()=>[l(X,{ref_key:"$table",ref:d,"query-items":m.value,"onUpdate:queryItems":n[2]||(n[2]=t=>m.value=t),"is-pagination":!1,columns:F,"get-data":a(u).getResources,"single-line":!0},{queryBar:i(()=>[l(W,{label:"资源名","label-width":50},{default:i(()=>[l(a(y),{value:m.value.keyword,"onUpdate:value":n[0]||(n[0]=t=>m.value.keyword=t),clearable:"",type:"text",placeholder:"请输入资源名",onKeydown:n[1]||(n[1]=I(t=>{var N;return(N=d.value)==null?void 0:N.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),l(S,{visible:a(f),"onUpdate:visible":n[6]||(n[6]=t=>L(f)?f.value=t:null),title:a(R),loading:a(E),onSave:a(b)},{default:i(()=>[l(a(T),{ref_key:"modalFormRef",ref:g,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:i(()=>[l(a(c),{label:"资源名",path:"name"},{default:i(()=>[l(a(y),{value:a(r).name,"onUpdate:value":n[3]||(n[3]=t=>a(r).name=t),placeholder:"请输入资源名"},null,8,["value"])]),_:1}),l(a(c),{label:"资源路径",path:"url"},{default:i(()=>[l(a(y),{value:a(r).url,"onUpdate:value":n[4]||(n[4]=t=>a(r).url=t),placeholder:"请输入资源路径"},null,8,["value"])]),_:1}),l(a(c),{label:"请求方式",path:"request_method"},{default:i(()=>[l(a(ae),{value:a(r).request_method,"onUpdate:value":n[5]||(n[5]=t=>a(r).request_method=t),name:"radiogroup"},{default:i(()=>[l(a(le),null,{default:i(()=>[(U(),O(G,null,w(B,t=>l(a(te),{key:t,value:t},{default:i(()=>[l(a(Z),{type:k(t)},{default:i(()=>[q(J(t),1)]),_:2},1032,["type"])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"]),l(S,{visible:s.value,"onUpdate:visible":n[8]||(n[8]=t=>s.value=t),title:`${a(v)==="add"?"新增":"编辑"}模块`,loading:a(f),onSave:A},{default:i(()=>[l(a(T),{ref_key:"modalFormRef",ref:g,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:i(()=>[l(a(c),{label:"模块名",path:"name"},{default:i(()=>[l(a(y),{value:a(r).name,"onUpdate:value":n[7]||(n[7]=t=>a(r).name=t),placeholder:"请输入模块名"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1}))}});export{qe as default};
