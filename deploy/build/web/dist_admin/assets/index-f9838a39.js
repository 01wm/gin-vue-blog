import{x as N,k as f,o as $,c as C,w as i,m as v,a as r,b as g,u as s,l as I,d as k,z as n,E as z,F as P,N as o,A as B,B as m}from"./index-7e9df7d9.js";import{_ as U}from"./CommonPage-7491aea4.js";import{_ as q}from"./QueryItem-0f282244.js";import{_ as T}from"./CrudTable-121684b7.js";import{u as D}from"./useCRUD-f64dec52.js";import{N as M}from"./Image-77507ba9.js";import{N as S,a as h}from"./Tabs-44f6c44d.js";import{N as R}from"./Input-5db271d7.js";import{N as V}from"./Popconfirm-6b45faf2.js";import"./AppPage-848b5b84.js";import"./Space-f54cd109.js";import"./RadioGroup-757891b8.js";import"./get-slot-1efb97e5.js";import"./Checkbox-ac1591ea.js";import"./Forward-8d8448e7.js";import"./utils-3c01791b.js";import"./Add-3a899e67.js";const K=k("span",{class:"i-material-symbols:recycling-rounded"},null,-1),j=k("span",{class:"i-ic:outline-approval"},null,-1),re=Object.assign({name:"留言管理"},{__name:"index",setup(A){N(()=>{_("all")});const l=f(null),u=f({nickname:""}),c=f({is_review:null}),{handleDelete:y}=D({name:"留言",doDelete:v.deleteMessages,refresh:()=>{var e;return(e=l.value)==null?void 0:e.handleSearch()}}),b=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render(e){return n(M,{height:50,imgProps:{style:{"border-radius":"3px"}},src:z(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"留言人",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"留言内容",key:"content",width:120,align:"center"},{title:"IP 地址",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0}},{title:"IP 来源",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return n("span",e.ip_source||"未知")}},{title:"留言时间",key:"created_at",align:"center",width:80,render(e){return n(o,{size:"small",type:"text",ghost:!0},{default:()=>B(e.created_at),icon:m("mdi:update",{size:18})})}},{title:"状态",key:"is_review",width:50,align:"center",render(e){return n(P,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(e){return[e.is_review?n(o,{size:"small",type:"warning",onClick:()=>p([e.id],0)},{default:()=>"撤下",icon:m("mi:circle-error",{})}):n(o,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>p([e.id],1)},{default:()=>"通过",icon:m("mi:circle-check",{})}),n(V,{onPositiveClick:()=>y([e.id],!1)},{trigger:()=>n(o,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:m("material-symbols:delete-outline",{size:16})}),default:()=>n("div",{},"确定删除该条留言吗?")})]}}];async function p(e,t){var a;if(!e.length){$message.info("请选择要审核的数据");return}await v.updateMessageReview({ids:e,is_review:t}),$message==null||$message.success(t?"审核成功":"撤下成功"),(a=l.value)==null||a.handleSearch()}function _(e){var t;switch(e){case"all":c.value.is_review=null;break;case"has_review":c.value.is_review=1;break;case"not_review":c.value.is_review=0;break}(t=l.value)==null||t.handleSearch()}return(e,t)=>($(),C(U,{title:"留言管理"},{action:i(()=>{var a,d;return[r(s(o),{type:"error",disabled:!((a=l.value)!=null&&a.selections.length),onClick:t[0]||(t[0]=x=>{var w;return s(y)((w=l.value)==null?void 0:w.selections)})},{icon:i(()=>[K]),default:i(()=>[g(" 批量删除 ")]),_:1},8,["disabled"]),r(s(o),{type:"success",disabled:!((d=l.value)!=null&&d.selections.length),onClick:t[1]||(t[1]=x=>p(l.value.selections,1))},{icon:i(()=>[j]),default:i(()=>[g(" 批量通过 ")]),_:1},8,["disabled"])]}),default:i(()=>[r(s(S),{type:"line",animated:"","onUpdate:value":_},{prefix:i(()=>[g(" 状态 ")]),default:i(()=>[r(s(h),{name:"all",tab:"全部"}),r(s(h),{name:"has_review",tab:"通过"}),r(s(h),{name:"not_review",tab:"审核中"})]),_:1}),r(T,{ref_key:"$table",ref:l,"query-items":u.value,"onUpdate:queryItems":t[4]||(t[4]=a=>u.value=a),"extra-params":c.value,columns:b,"get-data":s(v).getMessages},{queryBar:i(()=>[r(q,{label:"用户","label-width":40,"content-width":180},{default:i(()=>[r(s(R),{value:u.value.nickname,"onUpdate:value":t[2]||(t[2]=a=>u.value.nickname=a),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:t[3]||(t[3]=I(a=>{var d;return(d=l.value)==null?void 0:d.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{re as default};
