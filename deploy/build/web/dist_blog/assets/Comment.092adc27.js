import{_ as q,I as G,C as J,r as h,E as K,l as z,b as a,c as o,f as e,u as I,s as H,e as $,N as W,j as b,H as T,v as M,i,F as D,z as P,o as X,L as Z,w as ee,n as te,h as F,x as A,y as Y}from"./index.992b8db2.js";import{d as j}from"./dayjs.min.0c035c25.js";import{_ as se}from"./ULoading.873d0242.js";const ne={key:0,class:"mt-4 flex border-1 border-color-#90939950 border-rounded-1rem border-solid p-2"},ae=["src"],oe={class:"my-1 ml-3 w-full"},le=["placeholder"],ce={class:"flex justify-between"},ie={__name:"CommentField",props:{type:Number,show:Boolean,topicId:Number},emits:["afterSubmit"],setup(m,{expose:N,emit:k}){var u;const R=m,g=k,[c,p]=[G(),J()],v=h(R.show),n=K({nickname:"",content:"",topic_id:(u=R.topicId)!=null?u:0,reply_user_id:0,parent_id:0,type:R.type}),x=z(()=>!!n.nickname);function y(d){v.value=d}async function w(){var d,r;if(!c.userId){p.setLoginFlag(!0);return}if(!n.content.trim()){(d=window.$message)==null||d.error("\u8BC4\u8BBA\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");return}try{await T.saveComment(n),(r=window.$message)==null||r.info("\u8BC4\u8BBA\u6210\u529F"),n.content="",x.value&&y(!1),g("afterSubmit")}catch{}}function C(){var d;(d=window.$message)==null||d.info("\u8868\u60C5\u9009\u62E9\u6B63\u5728\u5F00\u53D1\u4E2D...")}const S=z(()=>n.nickname?`\u56DE\u590D @${n.nickname}\uFF1A`:"\u7559\u4E0B\u70B9\u4EC0\u4E48\u5427...");return N({data:n,setReply:y}),(d,r)=>v.value?(a(),o("div",ne,[e("img",{class:"h-9 w-9",src:I(H)(I(c).avatar)},null,8,ae),e("div",oe,[$(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=L=>n.content=L),placeholder:S.value,rows:"5",class:"w-full rounded bg-light-400 p-2 outline-none"},null,8,le),[[W,n.content]]),e("div",ce,[e("span",{class:"i-mdi:emoticon-happy-outline cursor-pointer text-xl text-orange",onClick:C}),e("div",null,[n.nickname?(a(),o("span",{key:0,class:"the-button mr-4 bg-bluegray hover:bg-bluegray",onClick:r[1]||(r[1]=L=>y(!1))}," \u53D6\u6D88 ")):b("",!0),e("span",{class:"the-button",onClick:w}," \u63D0\u4EA4 ")])])])])):b("",!0)}},U=q(ie,[["__scopeId","data-v-92673d6f"]]);const re={class:"mb-10 mt-15 text-12"},ue={class:"mr-10"},_e=["onClick"],de={key:0,class:"color-#00a1d6 font-bold"},pe={key:1},fe={__name:"Paging",props:{pageTotal:Number,index:Number,commentId:Number},emits:["changeCurrent"],setup(m,{expose:N,emit:k}){const{pageTotal:R=0,index:g,commentId:c}=m,p=k,v=h(!1),n=h(1),x=z(()=>u=>u===n.value);function y(){n.value-=1,p("changeCurrent",n,g,c)}function w(){n.value+=1,p("changeCurrent",n,g,c)}function C(u){n.value=u,p("changeCurrent",n,g,c)}function S(u){v.value=u}return N({current:n,setShow:S}),(u,d)=>$((a(),o("div",re,[e("span",ue," \u5171 "+i(m.pageTotal)+" \u9875 ",1),$(e("a",{onClick:y}," \u4E0A\u4E00\u9875 ",512),[[M,n.value!==1]]),m.pageTotal<6?(a(!0),o(D,{key:0},P(m.pageTotal,r=>(a(),o("a",{key:r,class:"mx-5",onClick:L=>C(r)},[x.value(r)?(a(),o("span",de,i(r),1)):(a(),o("span",pe,i(r),1))],8,_e))),128)):b("",!0),$(e("a",{onClick:w}," \u4E0B\u4E00\u9875 ",512),[[M,n.value!==m.pageTotal]])],512)),[[M,v.value]])}},me=q(fe,[["__scopeId","data-v-7023cb22"]]),ve=e("p",{class:"flex items-center text-xl font-bold"},[e("span",{class:"i-fa:comments mr-3 text-blue"}),Y(" \u8BC4\u8BBA ")],-1),he={key:0},ge={class:"mb-4 mt-7 flex items-center text-xl font-bold"},ke=["src"],ye={class:"ml-3 flex flex-1 flex-col"},be={key:0,class:"text-sm"},xe=["href"],we={key:2,class:"ml-2 inline-block rounded-3 bg-#ffa51e px-6 py-1 text-xs color-#fff"},Ce={class:"flex justify-between text-sm"},$e={class:"flex items-center gap-2 py-1 color-#b3b3b3"},Re=["onClick"],Se=["onClick"],Le=["innerHTML"],Te=["src"],Ie={class:"ml-2 flex flex-1 flex-col"},Me={key:0,class:"text-sm"},Ne=["href"],Fe={key:2,class:"ml-6 inline-block rounded-3 bg-#ffa51e px-6 py-1 text-sm color-#fff"},De={class:"flex justify-between text-sm"},Ye={class:"flex items-center py-5 color-#b3b3b3"},ze={class:"mr-10"},Ae=["onClick"],He=["onClick"],Pe={key:0},Ve=["href"],Be=["innerHTML"],Ee=["onClick"],je={key:0,class:"my-2 h-1 bg-light-500"},Ue={class:"m-4 f-c-c"},qe={key:1,class:"mb-10 mt-30 text-center text-zinc"},Oe={__name:"Comment",props:{type:Number},setup(m){var E;const{type:N}=m,[k,R]=[G(),J()];X(()=>{x()});const g=+((E=Z().params.id)!=null?E:0),c=h([]),p=h(0),v=h(!1),n=K({type:N,page_size:10,page_num:1,topic_id:g});async function x(){v.value=!0;try{const s=await T.getComments(n);setTimeout(()=>{n.page_num===1?c.value=s.data.pageData:c.value.push(...s.data.pageData),p.value=s.data.total,n.page_num++,v.value=!1},800)}catch{}}function y(){n.page_num=1,x()}const w=h(!0);ee(c,()=>{w.value=!1,te(()=>{w.value=!0})},{deep:!1});const C=h(null);function S(s,_){C.value.forEach(f=>f.setReply(!1));const t=C.value[s];t&&(t.setReply(!0),t.data.nickname=_.nickname,t.data.reply_user_id=_.user_id,t.data.parent_id=c.value[s].id)}const u=h([]),d=h([]);async function r(s){const{data:_}=await T.getCommentReplies(c.value[s].id,{page_size:5,page_num:u.value[s].current});c.value[s].reply_vo_list=_,c.value[s].reply_count++,c.value[s].reply_count>5&&u.value[s].setShow(!0),d.value[s].style.display="none"}async function L(s,_){const{data:t}=await T.getCommentReplies(_.id,{page_num:1,page_size:5});_.reply_vo_list=t,_.reply_count>5&&u.value[s].setShow(!0),d.value[s].style.display="none"}async function O(s,_,t){const{data:f}=await T.getCommentReplies(t,{page_num:s,page_size:5});c[_].reply_vo_list=f}async function V(s){var _,t;if(!k.userId){R.setLoginFlag(!0);return}try{await T.saveLikeComment(s.id),k.commentLikeSet.includes(s.id)?(s.like_count--,(_=window.$message)==null||_.info("\u5DF2\u53D6\u6D88")):(s.like_count++,(t=window.$message)==null||t.success("\u5DF2\u70B9\u8D5E")),k.commentLike(s.id)}catch{}}const B=z(()=>s=>k.commentLikeSet.includes(s));return(s,_)=>(a(),o("div",null,[ve,F(U,{show:!0,type:m.type,"topic-id":g,onAfterSubmit:y},null,8,["type"]),p.value&&w.value?(a(),o("div",he,[e("p",ge,[e("span",null,i(p.value)+" \u8BC4\u8BBA ",1),e("span",{class:A(["i-uiw:reload ml-4 cursor-pointer text-xl",v.value?"animate-spin":""]),onClick:y},null,2)]),(a(!0),o(D,null,P(c.value,(t,f)=>(a(),o("div",{key:t.id,class:"my-1 flex"},[e("img",{src:I(H)(t.avatar),class:"h-[40px] w-[40px] duration-600 hover:rotate-360"},null,8,ke),e("div",ye,[e("p",null,[t.website?(a(),o("a",{key:1,href:t.website,target:"_blank",class:"font-500 color-#1abc9c transition-300"},i(t.nickname),9,xe)):(a(),o("span",be,i(t.nickname),1)),t.user_id===10?(a(),o("span",we," \u535A\u4E3B ")):b("",!0)]),e("div",Ce,[e("div",$e,[e("span",null,i(p.value-f)+"\u697C ",1),e("span",null,i(I(j)(t.created_at).format("YYYY-MM-DD")),1),e("button",{class:A(["i-mdi:thumb-up hover-bg-red",B.value(t.id)?"bg-red":""]),onClick:l=>V(t)},null,10,Re),$(e("span",null,i(t.like_count),513),[[M,t.like_count]])]),e("button",{class:"color-#ef2f11",onClick:l=>S(f,t)}," \u56DE\u590D ",8,Se)]),e("div",{class:"my-1",innerHTML:t.content},null,8,Le),(a(!0),o(D,null,P(t.reply_vo_list,l=>(a(),o("div",{key:l.id,class:"mt-2 flex"},[e("img",{src:I(H)(l.avatar),class:"h-[40px] w-[40px] duration-600 hover:rotate-360"},null,8,Te),e("div",Ie,[e("div",null,[l.website?(a(),o("a",{key:1,href:l.website,target:"_blank",class:"font-500 color-#1abc9c transition-300"},i(l.nickname),9,Ne)):(a(),o("span",Me,i(l.nickname),1)),l.user_id===10?(a(),o("span",Fe," \u535A\u4E3B ")):b("",!0)]),e("div",De,[e("div",Ye,[e("span",ze,i(I(j)(l.created_at).format("YYYY-MM-DD")),1),e("button",{class:A(["i-mdi:thumb-up hover-bg-red",B.value(l.id)?"bg-red":""]),onClick:Q=>V(l)},null,10,Ae),$(e("span",null,i(l.like_count),513),[[M,l.like_count]])]),e("button",{class:"color-#ef2f11",onClick:Q=>S(f,l)}," \u56DE\u590D ",8,He)]),e("div",null,[l.reply_user_id!==t.user_id?(a(),o(D,{key:0},[l.reply_website?(a(),o("a",{key:1,href:l.reply_website,target:"_blank"}," @"+i(l.reply_nickname),9,Ve)):(a(),o("span",Pe," @"+i(l.reply_nickname),1)),Y(" \uFF0C ")],64)):b("",!0),e("span",{class:"my-3",innerHTML:l.content},null,8,Be)])])]))),128)),$(e("div",{ref_for:!0,ref_key:"checkRefs",ref:d,class:"mt-15 text-13 color-#6d757a"},[Y(" \u5171 "),e("b",null,i(t.reply_count),1),Y(" \u6761\u56DE\u590D "),e("button",{class:"color-#00a1d6",onClick:l=>L(f,t)}," \uFF0C\u70B9\u51FB\u67E5\u770B ",8,Ee)],512),[[M,t.reply_count>3]]),F(me,{ref_for:!0,ref_key:"pageRefs",ref:u,"page-total":Math.ceil(t.reply_count/5),index:f,"comment-id":t.id,onChangeCurrent:O},null,8,["page-total","index","comment-id"]),F(U,{ref_for:!0,ref_key:"replyFieldRefs",ref:C,show:!1,type:m.type,"topic-id":g,onAfterSubmit:l=>r(f)},null,8,["type","onAfterSubmit"]),f+1!==p.value?(a(),o("div",je)):b("",!0)])]))),128)),e("div",Ue,[p.value>c.value.length&&!v.value?(a(),o("button",{key:0,text:"",onClick:x}," \u70B9\u51FB\u52A0\u8F7D\u66F4\u591A... ")):b("",!0),F(se,{show:v.value},null,8,["show"])])])):(a(),o("div",qe," \u6682\u65E0\u8BC4\u8BBA\uFF0C\u6765\u53D1\u8BC4\u8BBA\u5427~ "))]))}};export{Oe as _};
