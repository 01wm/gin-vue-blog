import{_ as e}from"./CommonPage.a8aaeea9.js";import{_ as a}from"./CrudTable.d6949f2f.js";import{_ as t}from"./QueryBarItem.0f4fff77.js";import{_ as l}from"./TheIcon.2954b663.js";import{m as i,ac as r,z as s,H as n,c as o,w as d,o as c,a as u,d as m,b as p,_ as v,F as f,j as h,bx as y,au as g,av as w,bl as _}from"./index.9c865cdf.js";import{u as b}from"./useCRUD.85f3a0a5.js";import{c as k,d as j}from"./data.67ec6cdf.js";import{N as x}from"./Image.8f55d63d.js";import{N as C}from"./Popconfirm.1938afcb.js";import{_ as z,a as P}from"./Tabs.01569d58.js";import{_ as S}from"./Input.463ffced.js";import{_ as U}from"./Select.433e10cf.js";import"./AppPage.383132e7.js";import"./Space.1cedc616.js";import"./get-slot.8207e825.js";import"./Checkbox.411021da.js";import"./RadioGroup.42efc504.js";import"./Forward.2d3992a8.js";import"./utils.3e78d745.js";import"./Add.313e5361.js";const q=i({name:"评论管理"}),I=Object.assign(q,{setup(i){r((()=>{A("all")}));const q=s(null),I=s({}),$=s({}),{handleDelete:D}=b({name:"评论",doDelete:n.deleteComments,refresh:()=>{var e;return null==(e=q.value)?void 0:e.handleSearch()}}),R=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render:e=>h(x,{height:50,imgProps:{style:{"border-radius":"3px"}},src:y(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})},{title:"评论人",key:"nickname",width:50,align:"center",ellipsis:{tooltip:!0}},{title:"回复对象",key:"reply_nick_name",width:50,align:"center",render:e=>h("span",e.reply_nickname||"无")},{title:"评论内容",key:"content",width:140,align:"center",ellipsis:{tooltip:!0}},{title:"评论时间",key:"created_at",align:"center",width:60,render:e=>h(v,{size:"small",type:"text",ghost:!0},{default:()=>g(e.created_at),icon:w("mdi:update",{size:18})})},{title:"状态",key:"is_review",width:50,align:"center",render:e=>h(_,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})},{title:"来源",key:"type",width:50,align:"center",render:e=>h(_,{type:j[e.type].tag},{default:()=>j[e.type].name})},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render:e=>[e.is_review?h(v,{size:"small",type:"warning",style:"margin-left: 15px;",onClick:()=>T([e.id],0)},{default:()=>"撤下",icon:w("mi:circle-error",{size:14})}):h(v,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>T([e.id],1)},{default:()=>"通过",icon:w("mi:circle-check",{size:14})}),h(C,{onPositiveClick:()=>D([e.id],!1)},{trigger:()=>h(v,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:w("material-symbols:delete-outline",{size:14})}),default:()=>h("div",{},"确定删除该条评论吗?")})]}];function T(e,a){return t=this,l=null,i=function*(){var t;e.length?(yield n.updateCommentReview({ids:e,is_review:a}),null==$message||$message.success(a?"审核成功":"撤下成功"),null==(t=q.value)||t.handleSearch()):$message.info("请选择要审核的数据")},new Promise(((e,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},s=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(r,s);n((i=i.apply(t,l)).next())}));var t,l,i}function A(e){var a;switch(e){case"all":$.value.is_review=null;break;case"has_review":$.value.is_review=1;break;case"not_review":$.value.is_review=0}null==(a=q.value)||a.handleSearch()}return(i,r)=>{const s=l,h=z,y=P,g=S,w=t,_=U,b=a,j=e;return c(),o(j,{"show-footer":"",title:"评论管理"},{action:d((()=>{var e,a;return[u(p(v),{"ml-20":"",type:"error",disabled:!(null==(e=q.value)?void 0:e.selections.length),onClick:r[0]||(r[0]=e=>{var a;return p(D)(null==(a=q.value)?void 0:a.selections)})},{default:d((()=>[u(s,{icon:"material-symbols:recycling-rounded",size:18,"mr-5":""}),m(" 批量删除 ")])),_:1},8,["disabled"]),u(p(v),{"ml-20":"",type:"success",disabled:!(null==(a=q.value)?void 0:a.selections.length),onClick:r[1]||(r[1]=e=>T(q.value.selections,1))},{default:d((()=>[u(s,{icon:"ic:outline-approval",size:18,"mr-5":""}),m(" 批量通过 ")])),_:1},8,["disabled"])]})),default:d((()=>[u(y,{type:"line",animated:"","onUpdate:value":A},{prefix:d((()=>[m(" 状态 ")])),default:d((()=>[u(h,{name:"all",tab:"全部"}),u(h,{name:"has_review",tab:"通过"}),u(h,{name:"not_review",tab:"审核中"})])),_:1}),u(b,{ref_key:"$table",ref:q,"query-items":I.value,"onUpdate:query-items":r[6]||(r[6]=e=>I.value=e),"extra-params":$.value,columns:R,"get-data":p(n).getComments},{queryBar:d((()=>[u(w,{label:"用户","label-width":40,"content-width":180},{default:d((()=>[u(g,{value:I.value.nickname,"onUpdate:value":r[2]||(r[2]=e=>I.value.nickname=e),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:r[3]||(r[3]=f((e=>{var a;return null==(a=q.value)?void 0:a.handleSearch()}),["enter"]))},null,8,["value"])])),_:1}),u(w,{label:"来源","label-width":40,"content-width":160},{default:d((()=>[u(_,{value:I.value.type,"onUpdate:value":[r[4]||(r[4]=e=>I.value.type=e),r[5]||(r[5]=e=>{var a;return null==(a=q.value)?void 0:a.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择评论来源",options:p(k)},null,8,["value","options"])])),_:1})])),_:1},8,["query-items","extra-params","get-data"])])),_:1})}}});export{I as default};
