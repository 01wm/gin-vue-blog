var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a,l)=>new Promise(((t,r)=>{var o=e=>{try{n(l.next(e))}catch(a){r(a)}},i=e=>{try{n(l.throw(e))}catch(a){r(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,i);n((l=l.apply(e,a)).next())}));import{_ as i}from"./CommonPage.82132f80.js";import{_ as n}from"./CrudModal.ac49fde8.js";import{_ as s}from"./CrudTable.3c7aac4b.js";import{_ as d}from"./QueryBarItem.47443169.js";import{_ as u}from"./TheIcon.4b855aa1.js";import{m,z as c,H as p,ac as f,q as v,c as h,w as y,o as b,a as _,d as g,b as j,_ as w,F as k,g as U,bV as q,ak as O,at as P,j as S,bl as T,au as C,av as E,t as R}from"./index.9d7012d3.js";import{u as x}from"./useCRUD.774ac15a.js";import{_ as z}from"./GradientText.7f0db7f1.js";import{N as F}from"./Switch.cee4c352.js";import{N as D}from"./Popconfirm.d2d26363.js";import{_ as I}from"./Input.97383cda.js";import{_ as V,a as A}from"./FormItem.9268271e.js";import{_ as G}from"./Space.ac4d43a7.js";import{_ as $,a as B}from"./RadioGroup.e4f264c7.js";import"./AppPage.0b05ab95.js";import"./Checkbox.37cf1be9.js";import"./Select.0b9c566a.js";import"./Forward.219497c7.js";import"./get-slot.8207e825.js";const L=m({name:"接口管理"}),K=Object.assign(L,{setup(e){const m=c(null),L=c({}),{modalVisible:K,modalAction:N,modalTitle:H,modalLoading:M,handleAdd:Q,handleDelete:J,handleEdit:W,handleSave:X,modalForm:Y,modalFormRef:Z}=x({name:"接口",doCreate:p.saveOrUpdateResource,doDelete:p.deleteResource,doUpdate:p.saveOrUpdateResource,refresh:()=>{var e;return null==(e=m.value)?void 0:e.handleSearch()}});f((()=>{var e;null==(e=m.value)||e.handleSearch()}));const ee=["GET","POST","DELETE","PUT"],ae=v((()=>e=>{switch(e){case"GET":default:return"info";case"POST":return"success";case"PUT":return"warning";case"DELETE":return"error"}})),le=[{title:"资源名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"资源路径",key:"url",width:100,ellipsis:{tooltip:!0}},{title:"请求方式",key:"request_method",width:50,align:"center",render:e=>e.children?"":S(T,{type:ae.value(e.request_method)},{default:()=>e.request_method})},{title:"匿名访问",key:"is_hidden",width:50,align:"center",fixed:"left",render:e=>e.children?"":S(F,{size:"small",rubberBand:!1,value:e.is_anonymous,loading:!!e.publishing,checkedValue:1,uncheckedValue:0,onUpdateValue:()=>function(e){return o(this,null,(function*(){e.id&&(e.publishing=!0,e.is_anonymous=0===e.is_anonymous?1:0,yield p.updateResourceAnonymous(e),e.publishing=!1,null==$message||$message.success(e.is_anonymous?"已允许匿名访问":"已禁止匿名访问"))}))}(e)})},{title:"创建日期",key:"created_at",width:60,render:e=>S("span",C(e.created_at))},{title:"操作",key:"actions",width:115,align:"center",fixed:"right",render:e=>[S(w,{size:"tiny",quaternary:!0,type:"primary",style:`display: ${e.children?"":"none"};`,onClick:()=>{Q(),Y.value.parent_id=e.id}},{default:()=>"新增",icon:E("material-symbols:add",{size:14})}),S(w,{size:"tiny",quaternary:!0,type:"info",onClick:()=>e.children?function(e){N.value="edit",Y.value=((e,o)=>{for(var i in o||(o={}))l.call(o,i)&&r(e,i,o[i]);if(a)for(var i of a(o))t.call(o,i)&&r(e,i,o[i]);return e})({},e),te.value=!0}(e):W(e)},{default:()=>"编辑",icon:E("material-symbols:edit-outline",{size:14})}),S(D,{onPositiveClick:()=>{J(e.id,!1)}},{trigger:()=>S(w,{size:"tiny",quaternary:!0,type:"error"},{default:()=>"删除",icon:E("material-symbols:delete-outline",{size:14})}),default:()=>S("div",{},"确定删除该接口吗?")})]}];let te=c(!1);function re(){N.value="add",Y.value={},te.value=!0}function oe(){return o(this,null,(function*(){X(),te.value=!1}))}return(e,a)=>{const l=u,t=I,r=d,o=s,c=V,f=z,v=B,S=G,T=$,C=A,E=n,x=i;return b(),h(x,{"show-footer":"",title:"接口管理"},{action:y((()=>[_(j(w),{type:"primary",onClick:re},{default:y((()=>[_(l,{icon:"material-symbols:add",size:18}),g(" 新增模块 ")])),_:1})])),default:y((()=>[_(o,{ref_key:"$table",ref:m,"query-items":L.value,"onUpdate:query-items":a[1]||(a[1]=e=>L.value=e),"is-pagination":!1,columns:le,"get-data":j(p).getResources,"single-line":!0},{queryBar:y((()=>[_(r,{label:"资源名","label-width":50},{default:y((()=>{var e;return[_(t,{value:L.value.keyword,"onUpdate:value":a[0]||(a[0]=e=>L.value.keyword=e),clearable:"",type:"text",placeholder:"请输入资源名",onKeydown:k(null==(e=m.value)?void 0:e.handleSearch,["enter"])},null,8,["value","onKeydown"])]})),_:1})])),_:1},8,["query-items","get-data"]),_(E,{visible:j(K),"onUpdate:visible":a[5]||(a[5]=e=>P(K)?K.value=e:null),title:j(H),loading:j(M),onOnSave:j(X)},{default:y((()=>[_(C,{ref_key:"modalFormRef",ref:Z,"label-placement":"left","label-align":"left","label-width":80,model:j(Y)},{default:y((()=>[_(c,{label:"资源名",path:"name"},{default:y((()=>[_(t,{value:j(Y).name,"onUpdate:value":a[2]||(a[2]=e=>j(Y).name=e),placeholder:"请输入资源名"},null,8,["value"])])),_:1}),_(c,{label:"资源路径",path:"url"},{default:y((()=>[_(t,{value:j(Y).url,"onUpdate:value":a[3]||(a[3]=e=>j(Y).url=e),placeholder:"请输入资源路径"},null,8,["value"])])),_:1}),_(c,{label:"请求方式",path:"request_method"},{default:y((()=>[_(T,{value:j(Y).request_method,"onUpdate:value":a[4]||(a[4]=e=>j(Y).request_method=e),name:"radiogroup"},{default:y((()=>[_(S,null,{default:y((()=>[(b(),U(O,null,q(ee,(e=>_(v,{key:e,value:e},{default:y((()=>[_(f,{type:ae.value(e)},{default:y((()=>[g(R(e),1)])),_:2},1032,["type"])])),_:2},1032,["value"]))),64))])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","loading","onOnSave"]),_(E,{visible:te.value,"onUpdate:visible":a[7]||(a[7]=e=>te.value=e),title:("add"===j(N)?"新增":"编辑")+"模块",loading:j(K),onOnSave:oe},{default:y((()=>[_(C,{ref_key:"modalFormRef",ref:Z,"label-placement":"left","label-align":"left","label-width":80,model:j(Y)},{default:y((()=>[_(c,{label:"模块名",path:"name"},{default:y((()=>[_(t,{value:j(Y).name,"onUpdate:value":a[6]||(a[6]=e=>j(Y).name=e),placeholder:"请输入模块名"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","loading"])])),_:1})}}});export{K as default};
