var e=(e,a,l)=>new Promise(((t,n)=>{var s=e=>{try{i(l.next(e))}catch(a){n(a)}},u=e=>{try{i(l.throw(e))}catch(a){n(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,u);i((l=l.apply(e,a)).next())}));import{_ as a}from"./CommonPage.82132f80.js";import{_ as l}from"./CrudModal.ac49fde8.js";import{_ as t}from"./TheIcon.4b855aa1.js";import{az as n,i as s,aL as u,bO as i,k as o,m as r,n as d,aa as p,z as c,p as m,Z as v,a9 as g,q as f,x as h,j as y,bl as b,_,N as j,bP as C,am as w,ao as O,bQ as U,f as x,bR as I,a4 as T,bd as S,c as k,w as z,u as V,D as F,o as $,e as A,a as B,h as P,d as R,b as D,H as q}from"./index.9d7012d3.js";import{E as K}from"./style.094cf8fe.js";import{_ as N}from"./UploadOne.09cb9ca2.js";import{a as W}from"./data.67ec6cdf.js";import{_ as E,a as G}from"./FormItem.9268271e.js";import{i as H,u as L,_ as M}from"./Input.97383cda.js";import{s as Q,_ as Z}from"./Space.ac4d43a7.js";import{a as J,_ as X}from"./Select.0b9c566a.js";import{A as Y}from"./Add.b0e8deec.js";import{a as ee,_ as ae}from"./RadioGroup.e4f264c7.js";import{N as le}from"./Switch.cee4c352.js";import"./AppPage.0b05ab95.js";import"./Upload.d16506ed.js";import"./Image.eafc70f4.js";import"./utils.3e78d745.js";import"./get-slot.8207e825.js";const te=n({name:"DynamicTags",common:s,peers:{Input:H,Button:u,Tag:i,Space:Q},self:()=>({inputWidth:"64px"})}),ne=o("dynamic-tags",[o("input",{minWidth:"var(--n-input-width)"})]),se=r({name:"DynamicTags",props:Object.assign(Object.assign(Object.assign({},m.props),C),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:e=>e},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),setup(e){const{mergedClsPrefixRef:a,inlineThemeDisabled:l}=d(e),{localeRef:t}=L("DynamicTags"),n=p(e),{mergedDisabledRef:s}=n,u=c(""),i=c(!1),o=c(!0),r=c(null),y=m("DynamicTags","-dynamic-tags",ne,te,e,a),b=c(e.defaultValue),_=v(e,"value"),j=g(_,b),C=f((()=>t.value.add)),U=f((()=>J(e.size))),x=f((()=>s.value||!!e.max&&j.value.length>=e.max));function I(a){const{onChange:l,"onUpdate:value":t,onUpdateValue:s}=e,{nTriggerFormInput:u,nTriggerFormChange:i}=n;l&&O(l,a),s&&O(s,a),t&&O(t,a),b.value=a,u(),i()}function T(a){const l=null!=a?a:u.value;if(l){const a=j.value.slice(0);a.push(e.onCreate(l)),I(a)}i.value=!1,o.value=!0,u.value=""}const S=f((()=>{const{self:{inputWidth:e}}=y.value;return{"--n-input-width":e}})),k=l?h("dynamic-tags",void 0,S,e):void 0;return{mergedClsPrefix:a,inputInstRef:r,localizedAdd:C,inputSize:U,inputValue:u,showInput:i,inputForceFocused:o,mergedValue:j,mergedDisabled:s,triggerDisabled:x,handleInputKeyUp:function(e){if("Enter"===e.key)T()},handleAddClick:function(){i.value=!0,w((()=>{var e;null===(e=r.value)||void 0===e||e.focus(),o.value=!1}))},handleInputBlur:function(){T()},handleCloseClick:function(e){const a=j.value.slice(0);a.splice(e,1),I(a)},handleInputConfirm:T,mergedTheme:y,cssVars:l?void 0:S,themeClass:null==k?void 0:k.themeClass,onRender:null==k?void 0:k.onRender}},render(){const{mergedTheme:e,cssVars:a,mergedClsPrefix:l,onRender:t,renderTag:n}=this;return null==t||t(),y(Z,{class:[`${l}-dynamic-tags`,this.themeClass],size:"small",style:a,theme:e.peers.Space,themeOverrides:e.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:e,tagStyle:a,type:t,round:s,size:u,color:i,closable:o,mergedDisabled:r,showInput:d,inputValue:p,inputStyle:c,inputSize:m,inputForceFocused:v,triggerDisabled:g,handleInputKeyUp:f,handleInputBlur:h,handleAddClick:C,handleCloseClick:w,handleInputConfirm:O,$slots:U}=this;return this.mergedValue.map(((l,d)=>n?n(l,d):y(b,{key:d,theme:e.peers.Tag,themeOverrides:e.peerOverrides.Tag,style:a,type:t,round:s,size:u,color:i,closable:o,disabled:r,onClose:()=>w(d)},{default:()=>"string"==typeof l?l:l.label}))).concat(d?U.input?U.input({submit:O,deactivate:h}):y(M,Object.assign({placeholder:"",size:m,style:c,autosize:!0},this.inputProps,{ref:"inputInstRef",value:p,onUpdateValue:e=>{this.inputValue=e},theme:e.peers.Input,themeOverrides:e.peerOverrides.Input,onKeyup:f,onBlur:h,internalForceFocus:v})):U.trigger?U.trigger({activate:C,disabled:g}):y(_,{dashed:!0,disabled:g,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,size:m,onClick:C},{icon:()=>y(j,{clsPrefix:l},{default:()=>y(Y,null)})}))}})}}),ue={"mb-15":"",flex:"","items-center":"","bg-white":""},ie=r({name:"发布文章"}),oe=U(Object.assign(ie,{setup(n){const[s,u]=[V(),F()],[i,o]=[x(),I()];let r=c([]),d=c([]),p=[];T(u,(()=>e(this,null,(function*(){return i.reloadPage()})))),S((()=>e(this,null,(function*(){q.getCategoryOption().then((e=>r.value=e.data.map((e=>({value:e.label,label:e.label}))))),q.getTagOption().then((e=>{d.value=e.data.map((e=>({value:e.label,label:e.label}))),p=d.value})),yield function(){return e(this,null,(function*(){var e,a,l;const t=u.params.id;if(t){null==(e=window.$loadingBar)||e.start(),$message.loading("加载中...");try{const e=yield q.getArticleById(t);v.value=e.data,null==(a=window.$loadingBar)||a.finish(),null==$message||$message.success("加载成功")}catch(n){null==(l=window.$loadingBar)||l.error(),null==$message||$message.error("加载失败")}}else v.value={status:1,is_top:0,title:""}}))}(),yield w((()=>{}))}))));const m=c(null);let v=c({status:1,is_top:0}),g=c(!1),f=c(!1);const h=c(null);function j(){$message.info("保存草稿开发中")}function C(){var e,a;if(!v.value.title||!(null==(e=v.value.title)?void 0:e.trim()))return v.value.title=null==(a=v.value.title)?void 0:a.trim(),void $message.info("请输入标题");f.value=!0}function O(){return e(this,null,(function*(){var a;null==(a=m.value)||a.validate((a=>e(this,null,(function*(){if(!a){g.value=!0,$message.loading("正在保存...");try{yield q.saveOrUpdateArticle(v.value),f.value=!1,$message.success("操作成功!"),o.removeTag(u.path),yield s.replace({path:"/article/list",query:{needRefresh:!0}})}catch(e){}finally{g.value=!1}}}))))}))}T((()=>v.value.tag_names),(e=>{d.value=p.filter((a=>!e.includes(a.label)))}),{deep:!0});const U={category_name:{required:!0,message:"请选择文章分类",trigger:["blur","change"]},tag_names:{required:!0,message:"请选择文章标签"}};function H(e,a){return y(b,{type:"info",disabled:a>3,closable:!0,onClose:()=>v.value.tag_names.splice(a,1)},{default:()=>e})}return(e,n)=>{const s=M,u=t,i=_,o=X,p=E,c=se,y=le,b=ee,w=Z,x=ae,I=G,T=l,S=a;return $(),k(S,{"show-header":!1,"show-footer":"",title:"写文章"},{default:z((()=>[A("div",ue,[B(s,{value:v.value.title,"onUpdate:value":n[0]||(n[0]=e=>v.value.title=e),type:"text",class:"flex-1 py-5 mr-20 text-18 font-bold color-primary",placeholder:"输入文章标题..."},null,8,["value"]),B(i,{ghost:"",type:"error","mr-10":"",loading:g.value,onClick:j},{default:z((()=>[g.value?P("",!0):($(),k(u,{key:0,icon:"line-md:uploading-loop","mr-5":"",size:18})),R(" 保存草稿 ")])),_:1},8,["loading"]),B(i,{type:"error",loading:g.value,onClick:C},{default:z((()=>[g.value?P("",!0):($(),k(u,{key:0,icon:"line-md:confirm-circle","mr-5":"",size:18})),R(" 发布文章 ")])),_:1},8,["loading"])]),B(D(K),{modelValue:v.value.content,"onUpdate:modelValue":n[1]||(n[1]=e=>v.value.content=e),style:{height:"calc(100vh - 305px)"}},null,8,["modelValue"]),B(T,{visible:f.value,"onUpdate:visible":n[10]||(n[10]=e=>f.value=e),title:"发布文章",loading:g.value,"show-footer":"",onOnSave:O},{default:z((()=>[B(I,{ref_key:"formRef",ref:m,"label-placement":"left","label-align":"left","label-width":100,model:v.value,rules:U},{default:z((()=>[B(p,{label:"文章分类",path:"category_name"},{default:z((()=>[B(o,{value:v.value.category_name,"onUpdate:value":n[2]||(n[2]=e=>v.value.category_name=e),style:{width:"50%"},clearable:"",tag:"",filterable:"",placeholder:"关键字搜索，enter 添加",options:r.value},null,8,["value","options"])])),_:1}),B(p,{label:"文章标签",path:"tag_names"},{default:z((()=>[B(c,{value:v.value.tag_names,"onUpdate:value":n[4]||(n[4]=e=>v.value.tag_names=e),"render-tag":H,max:3},{input:z((({submit:e,deactivate:a})=>[B(o,{value:h.value,"onUpdate:value":[n[3]||(n[3]=e=>h.value=e),a=>{e(a),h.value=null}],size:"small",filterable:"",tag:"",clearable:"",options:d.value,placeholder:"标签名称",onBlur:a},{action:z((()=>[R(" 输入标签名搜索，enter 添加自定义标签 ")])),_:2},1032,["value","options","onUpdate:value","onBlur"])])),_:1},8,["value"])])),_:1}),B(p,{label:"文章类型",path:"type"},{default:z((()=>[B(o,{value:v.value.type,"onUpdate:value":n[5]||(n[5]=e=>v.value.type=e),style:{width:"50%"},placeholder:"请选择文章分类",options:D(W)},null,8,["value","options"])])),_:1}),2===v.value.type||3===v.value.type?($(),k(p,{key:0,label:"原文地址",path:"original_url"},{default:z((()=>[B(s,{value:v.value.original_url,"onUpdate:value":n[6]||(n[6]=e=>v.value.original_url=e),type:"text",placeholder:"请填写原文连接"},null,8,["value"])])),_:1})):P("",!0),B(p,{label:"文章缩略图",path:"img"},{default:z((()=>[B(N,{preview:v.value.img,"onUpdate:preview":n[7]||(n[7]=e=>v.value.img=e),width:220},null,8,["preview"])])),_:1}),B(p,{label:"置顶",path:"is_top"},{default:z((()=>[B(y,{value:v.value.is_top,"onUpdate:value":n[8]||(n[8]=e=>v.value.is_top=e),"checked-value":1,"unchecked-value":0},null,8,["value"])])),_:1}),B(p,{label:"发布形式",path:"status"},{default:z((()=>[B(x,{value:v.value.status,"onUpdate:value":n[9]||(n[9]=e=>v.value.status=e),name:"radiogroup"},{default:z((()=>[B(w,null,{default:z((()=>[B(b,{value:1},{default:z((()=>[R(" 公开 ")])),_:1}),B(b,{value:2},{default:z((()=>[R(" 私密 ")])),_:1})])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","loading"])])),_:1})}}}),[["__scopeId","data-v-bb35e856"]]);export{oe as default};
