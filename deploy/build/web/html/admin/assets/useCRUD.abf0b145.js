var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,t=(a,l,n)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,o=(e,o)=>{for(var i in o||(o={}))l.call(o,i)&&t(e,i,o[i]);if(a)for(var i of a(o))n.call(o,i)&&t(e,i,o[i]);return e},i=(e,a,l)=>new Promise(((n,t)=>{var o=e=>{try{r(l.next(e))}catch(a){t(a)}},i=e=>{try{r(l.throw(e))}catch(a){t(a)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,i);r((l=l.apply(e,a)).next())}));import{z as r,q as u}from"./index.8ba31f54.js";const d={view:"查看",edit:"编辑",add:"新增"};function c({name:e,initForm:a={},doCreate:l,doDelete:n,doUpdate:t,refresh:c}){let s=r(!1),v=r(""),f=r(!1);const m=u((()=>d[v.value]+e));let w=r(o({},a));const h=r(null);return{modalVisible:s,modalAction:v,modalTitle:m,modalLoading:f,handleAdd:function(){v.value="add",s.value=!0,w.value=o({},a)},handleDelete:function(e,a=!0){return i(this,null,(function*(){if(!e||Array.isArray(e)&&!e.length)return void window.$message.info("请选择要删除的数据");const l=()=>i(this,null,(function*(){try{f.value=!0;const a=yield n(JSON.stringify(e));0===(null==a?void 0:a.code)&&window.$message.success("删除成功"),f.value=!1,c(a)}catch(a){f.value=!1}}));a?window.$dialog.confirm({content:"确定删除？",confirm:()=>l()}):l()}))},handleEdit:function(e){v.value="edit",s.value=!0,w.value=o({},e)},handleView:function(e){v.value="view",s.value=!0,w.value=o({},e)},handleSave:function(){var e;["edit","add"].includes(v.value)?null==(e=h.value)||e.validate((e=>i(this,null,(function*(){if(!e){const e={add:{api:()=>l(w.value),cb:()=>window.$message.success("新增成功")},edit:{api:()=>t(w.value),cb:()=>window.$message.success("编辑成功")}}[v.value];try{f.value=!0;const a=yield e.api();e.cb(),f.value=s.value=!1,a&&c(a)}catch(a){f.value=!1}}})))):s.value=!1},modalForm:w,modalFormRef:h}}export{c as u};
