import{_ as e}from"./CommonPage.3d59e7ac.js";import{_ as a}from"./CrudTable.79b8f87b.js";import{_ as t}from"./QueryBarItem.c712c54b.js";import{_ as i}from"./TheIcon.aefcbec7.js";import{m as l,ac as s,z as r,H as n,c as o,w as c,o as d,a as u,d as m,b as p,_ as v,F as f,j as h,bx as b,au as g,av as y,bl as w}from"./index.70bc36b3.js";import{u as _}from"./useCRUD.5608f24d.js";import{N as k}from"./Image.71f0b28b.js";import{N as j}from"./Popconfirm.c8873f31.js";import{_ as x,a as z}from"./Tabs.e1e870eb.js";import{_ as C}from"./Input.ea8d809e.js";import"./AppPage.0bbd3948.js";import"./Space.a9c4e2ac.js";import"./get-slot.8207e825.js";import"./Checkbox.4bbd4fe8.js";import"./RadioGroup.2e199a0e.js";import"./Select.c679e813.js";import"./Forward.4950def2.js";import"./utils.3e78d745.js";import"./Add.0acf478a.js";const P=l({name:"留言管理"}),I=Object.assign(P,{setup(l){s((()=>{D("all")}));const P=r(null),I=r({}),S=r({}),{handleDelete:q}=_({name:"留言",doDelete:n.deleteMessages,refresh:()=>{var e;return null==(e=P.value)?void 0:e.handleSearch()}}),U=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:50,align:"center",render:e=>h(k,{height:50,imgProps:{style:{"border-radius":"3px"}},src:b(e.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})},{title:"留言人",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"留言内容",key:"content",width:120,align:"center"},{title:"IP 地址",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0}},{title:"IP 来源",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render:e=>h("span",e.ip_source||"未知")},{title:"留言时间",key:"created_at",align:"center",width:80,render:e=>h(v,{size:"small",type:"text",ghost:!0},{default:()=>g(e.created_at),icon:y("mdi:update",{size:18})})},{title:"状态",key:"is_review",width:50,align:"center",render:e=>h(w,{type:e.is_review?"success":"error"},{default:()=>e.is_review?"通过":"审核中"})},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render:e=>[e.is_review?h(v,{size:"small",type:"warning",style:"margin-left: 15px;",onClick:()=>$([e.id],0)},{default:()=>"撤下",icon:y("mi:circle-error",{size:14})}):h(v,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>$([e.id],1)},{default:()=>"通过",icon:y("mi:circle-check",{size:14})}),h(j,{onPositiveClick:()=>q([e.id],!1)},{trigger:()=>h(v,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:y("material-symbols:delete-outline",{size:14})}),default:()=>h("div",{},"确定删除该条留言吗?")})]}];function $(e,a){return t=this,i=null,l=function*(){var t;e.length?(yield n.updateMessageReview({ids:e,is_review:a}),null==$message||$message.success(a?"审核成功":"撤下成功"),null==(t=P.value)||t.handleSearch()):$message.info("请选择要审核的数据")},new Promise(((e,a)=>{var s=e=>{try{n(l.next(e))}catch(t){a(t)}},r=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(s,r);n((l=l.apply(t,i)).next())}));var t,i,l}function D(e){var a;switch(e){case"all":S.value.is_review=null;break;case"has_review":S.value.is_review=1;break;case"not_review":S.value.is_review=0}null==(a=P.value)||a.handleSearch()}return(l,s)=>{const r=i,h=x,b=z,g=C,y=t,w=a,_=e;return d(),o(_,{"show-footer":"",title:"留言管理"},{action:c((()=>{var e,a;return[u(p(v),{"ml-20":"",type:"error",disabled:!(null==(e=P.value)?void 0:e.selections.length),onClick:s[0]||(s[0]=e=>{var a;return p(q)(null==(a=P.value)?void 0:a.selections)})},{default:c((()=>[u(r,{icon:"material-symbols:recycling-rounded",size:18}),m(" 批量删除 ")])),_:1},8,["disabled"]),u(p(v),{"ml-20":"",type:"success",disabled:!(null==(a=P.value)?void 0:a.selections.length),onClick:s[1]||(s[1]=e=>$(P.value.selections,1))},{default:c((()=>[u(r,{icon:"ic:outline-approval",size:18}),m(" 批量通过 ")])),_:1},8,["disabled"])]})),default:c((()=>[u(b,{type:"line",animated:"","onUpdate:value":D},{prefix:c((()=>[m(" 状态 ")])),default:c((()=>[u(h,{name:"all",tab:"全部"}),u(h,{name:"has_review",tab:"通过"}),u(h,{name:"not_review",tab:"审核中"})])),_:1}),u(w,{ref_key:"$table",ref:P,"query-items":I.value,"onUpdate:query-items":s[4]||(s[4]=e=>I.value=e),"extra-params":S.value,columns:U,"get-data":p(n).getMessages},{queryBar:c((()=>[u(y,{label:"用户","label-width":40,"content-width":180},{default:c((()=>[u(g,{value:I.value.nickname,"onUpdate:value":s[2]||(s[2]=e=>I.value.nickname=e),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:s[3]||(s[3]=f((e=>{var a;return null==(a=P.value)?void 0:a.handleSearch()}),["enter"]))},null,8,["value"])])),_:1})])),_:1},8,["query-items","extra-params","get-data"])])),_:1})}}});export{I as default};
