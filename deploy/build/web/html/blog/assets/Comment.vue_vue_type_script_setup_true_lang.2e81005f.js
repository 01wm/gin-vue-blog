import{b as n,c as o,g as e,j as U,ba as K,A as O,r as b,G as W,k as z,e as y,u as d,m as H,af as E,cP as ne,f as w,I as S,cU as oe,_ as X,J as T,h as c,F as M,v as N,o as ae,bd as se,w as ue,s as I,q as P,x as le,l as ie,n as ce,cV as re}from"./index.8c13a795.js";import{_ as _e}from"./Spin.d54163c2.js";import{f as J}from"./date.85a885f3.js";import{_ as de}from"./Image.ab112340.js";const me={class:"inline-block",viewBox:"0 0 20 20",width:"1em",height:"1em"},pe=e("path",{fill:"currentColor",d:"M19.295 12a.704.704 0 0 1 .705.709v3.204a.704.704 0 0 1-.7.709a.704.704 0 0 1-.7-.709v-1.125C16.779 17.844 13.399 20 9.757 20c-4.41 0-8.106-2.721-9.709-6.915a.712.712 0 0 1 .4-.917c.36-.141.766.04.906.405c1.4 3.662 4.588 6.01 8.403 6.01c3.371 0 6.52-2.182 7.987-5.154l-1.471.01a.704.704 0 0 1-.705-.704a.705.705 0 0 1 .695-.714L19.295 12Zm-9.05-12c4.408 0 8.105 2.721 9.708 6.915a.712.712 0 0 1-.4.917a.697.697 0 0 1-.906-.405c-1.4-3.662-4.588-6.01-8.403-6.01c-3.371 0-6.52 2.182-7.987 5.154l1.471-.01a.704.704 0 0 1 .705.704a.705.705 0 0 1-.695.714L.705 8A.704.704 0 0 1 0 7.291V4.087c0-.392.313-.709.7-.709c.386 0 .7.317.7.709v1.125C3.221 2.156 6.601 0 10.243 0Z"},null,-1),fe=[pe];function he(l,f){return n(),o("svg",me,fe)}const ve={name:"uiw-reload",render:he},ge={class:"inline-block",viewBox:"0 0 1792 1408",width:"1em",height:"1em"},ke=e("path",{fill:"currentColor",d:"M1408 512q0 139-94 257t-256.5 186.5T704 1024q-86 0-176-16q-124 88-278 128q-36 9-86 16h-3q-11 0-20.5-8t-11.5-21q-1-3-1-6.5t.5-6.5t2-6l2.5-5l3.5-5.5l4-5l4.5-5l4-4.5q5-6 23-25t26-29.5t22.5-29t25-38.5t20.5-44Q142 841 71 736T0 512q0-139 94-257T350.5 68.5T704 0t353.5 68.5T1314 255t94 257zm384 256q0 120-71 224.5T1526 1169q10 24 20.5 44t25 38.5t22.5 29t26 29.5t23 25q1 1 4 4.5t4.5 5t4 5t3.5 5.5l2.5 5l2 6l.5 6.5l-1 6.5q-3 14-13 22t-22 7q-50-7-86-16q-154-40-278-128q-90 16-176 16q-271 0-472-132q58 4 88 4q161 0 309-45t264-129q125-92 192-212t67-254q0-77-23-152q129 71 204 178t75 230z"},null,-1),ye=[ke];function be(l,f){return n(),o("svg",ge,ye)}const Ce={name:"fa-comments",render:be},we={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},xe=e("path",{fill:"currentColor",d:"M20 12a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8a8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5S7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5S14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"},null,-1),$e=[xe];function Be(l,f){return n(),o("svg",we,$e)}const De={name:"mdi-emoticon-happy-outline",render:Be},Fe={key:0,flex:"","p-10":"","mt-15":"","border-1px":"","border-solid":"","border-rounded-1rem":"","border-color":"#90939950"},Ae={"w-full":"","my-5":"","ml-12":""},Ee=["placeholder"],qe={flex:"","justify-between":""},Se=U({__name:"CommentField",props:{type:null,show:{type:Boolean},topicId:null},emits:["afterSubmit"],setup(l,{expose:f,emit:B}){var $;const h=l,[a,v]=[K(),O()];let g=b(h.show);const i=W({nickname:"",content:"",topic_id:($=h.topicId)!=null?$:0,reply_user_id:0,parent_id:0,type:h.type}),D=z(()=>!!i.nickname);function x(p){g.value=p}async function m(){var p,C;if(!a.userId){v.setLoginFlag(!0);return}if(!i.content.trim()){(p=window.$message)==null||p.error("\u8BC4\u8BBA\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");return}try{await S.saveComment(i),(C=window.$message)==null||C.info("\u8BC4\u8BBA\u6210\u529F"),i.content="",D.value&&x(!1),B("afterSubmit")}catch(R){console.error(R)}}function q(){var p;(p=window.$message)==null||p.info("\u8868\u60C5\u9009\u62E9\u6B63\u5728\u5F00\u53D1\u4E2D...")}const k=z(()=>i.nickname?`\u56DE\u590D @${i.nickname}\uFF1A`:"\u7559\u4E0B\u70B9\u4EC0\u4E48\u5427...");return f({data:i,setReply:x}),(p,C)=>{const R=oe,V=De;return g.value?(n(),o("div",Fe,[y(R,{round:"",size:36,src:d(H)(d(a).avatar)},null,8,["src"]),e("div",Ae,[E(e("textarea",{"onUpdate:modelValue":C[0]||(C[0]=L=>d(i).content=L),placeholder:d(k),rows:"5","text-16":"","w-full":"","bg-light-400":""},null,8,Ee),[[ne,d(i).content]]),e("div",qe,[y(V,{"text-24":"","text-orange":"","cursor-pointer":"",onClick:q}),e("div",null,[d(i).nickname?(n(),o("span",{key:0,btn:"","bg-bluegray":"","hover:bg-bluegray":"","mr-15":"",onClick:C[1]||(C[1]=L=>x(!1))}," \u53D6\u6D88 ")):w("",!0),e("span",{btn:"",onClick:m}," \u63D0\u4EA4 ")])])])])):w("",!0)}}});const Q=X(Se,[["__scopeId","data-v-d5beec5a"]]),Te={"mt-15":"","mb-10":"","text-12":""},Re={"mr-10":""},Le=["onClick"],Ie={key:0,color:"#00a1d6","font-bold":""},Me={key:1},ze=U({__name:"Paging",props:{pageTotal:{default:0},index:null,commentId:null},emits:["changeCurrent"],setup(l,{expose:f,emit:B}){let h=b(!1),a=b(1);const v=z(()=>m=>m===a.value);function g(){a.value-=1,B("changeCurrent",a.value,l.index,l.commentId)}function i(){a.value+=1,B("changeCurrent",a.value,l.index,l.commentId)}function D(m){a.value=m,B("changeCurrent",a.value,l.index,l.commentId)}function x(m){h.value=m}return f({current:a.value,setShow:x}),(m,q)=>E((n(),o("div",Te,[e("span",Re," \u5171 "+c(l.pageTotal)+" \u9875 ",1),E(e("a",{onClick:g}," \u4E0A\u4E00\u9875 ",512),[[T,a.value!==1]]),l.pageTotal<6?(n(!0),o(M,{key:0},N(l.pageTotal,k=>(n(),o("a",{key:k,"mx-5":"",onClick:$=>D(k)},[d(v)(k)?(n(),o("span",Ie,c(k),1)):(n(),o("span",Me,c(k),1))],8,Le))),128)):w("",!0),E(e("a",{onClick:i}," \u4E0B\u4E00\u9875 ",512),[[T,a.value!==l.pageTotal]])],512)),[[T,h.value]])}});const Ve=X(ze,[["__scopeId","data-v-30e2f6fc"]]),Pe={"text-20":"","font-bold":"",flex:"","items-center":""},He={key:0},Ne={"mt-30":"","mb-15":"","text-20":"","font-bold":"",flex:"","items-center":""},Ue={"flex-col":"","flex-1":"","ml-10":""},Ze={key:0,"text-14":""},je=["href"],Ge={key:2,bg:"#ffa51e",color:"#fff","px-6":"","py-1":"","ml-6":"","rounded-3":"","text-12":"","inline-block":""},Je={flex:"","justify-between":"","text-12":""},Qe={color:"#b3b3b3","py-5":"",flex:"","items-center":""},Ke={"mx-10":""},Oe=["onClick"],We=["onClick"],Xe=["innerHTML"],Ye={"flex-col":"","flex-1":"","ml-10":""},et={key:0,"text-14":""},tt=["href"],nt={key:2,bg:"#ffa51e",color:"#fff","px-6":"","py-1":"","ml-6":"","rounded-3":"","text-12":"","inline-block":""},ot={flex:"","justify-between":"","text-12":""},at={color:"#b3b3b3","py-5":"",flex:"","items-center":""},st={"mr-10":""},ut=["onClick"],lt=["onClick"],it={key:0},ct=["href"],rt=["innerHTML"],_t=["onClick"],dt={key:0,"h-1":"","bg-light-500":"","my-10":""},mt={"f-c-c":"","m-15":""},pt={key:1,"animate-bounce":""},ft={key:1,"text-center":"","mt-30":"","mb-10":"","text-zinc":"","text-16":""},yt=U({__name:"Comment",props:{type:null},setup(l){var j;const[f,B]=[K(),O()];ae(()=>{D()});const h=+((j=se().params.id)!=null?j:0);let a=b([]),v=b(0),g=b(!1);const i=W({type:l.type,page_size:10,page_num:1,topic_id:h});async function D(){g.value=!0;try{const t=await S.getComments(i);setTimeout(()=>{i.page_num===1?a.value=t.data.pageData:a.value.push(...t.data.pageData),v.value=t.data.total,i.page_num++,g.value=!1},800)}catch(t){console.error(t)}}function x(){i.page_num=1,D()}let m=b(!0);ue(a,()=>{m.value=!1,ce(()=>{m.value=!0})},{deep:!1});const q=b([]);function k(t,r){q.value.forEach(F=>F.setReply(!1));const _=q.value[t];_.setReply(!0),_.data.nickname=r.nickname,_.data.reply_user_id=r.user_id,_.data.parent_id=a.value[t].id}const $=b([]),p=b([]);async function C(t){const{data:r}=await S.getCommentReplies(a.value[t].id,{page_size:5,page_num:$.value[t].current});a.value[t].reply_vo_list=r,a.value[t].reply_count++,a.value[t].reply_count>5&&$.value[t].setShow(!0),p.value[t].style.display="none"}async function R(t,r){const{data:_}=await S.getCommentReplies(r.id,{page_num:1,page_size:5});r.reply_vo_list=_,r.reply_count>5&&$.value[t].setShow(!0),p.value[t].style.display="none"}async function V(t,r,_){const{data:F}=await S.getCommentReplies(_,{page_num:t,page_size:5});a.value[r].reply_vo_list=F}async function L(t){var r,_;if(!f.userId){B.setLoginFlag(!0);return}try{await S.saveLikeComment(t.id),f.commentLikeSet.includes(t.id)?(t.like_count--,(r=window.$message)==null||r.info("\u5DF2\u53D6\u6D88")):(t.like_count++,(_=window.$message)==null||_.success("\u5DF2\u70B9\u8D5E")),f.commentLike(t.id)}catch(F){console.error(F)}}const Z=z(()=>t=>f.commentLikeSet.includes(t));return(t,r)=>{const _=Ce,F=ve,G=de,Y=re,ee=_e;return n(),o("div",null,[e("p",Pe,[y(_,{"mr-5":"","text-24":"","text-blue":""}),I(" \u8BC4\u8BBA ")]),y(Q,{show:!0,type:l.type,"topic-id":h,onAfterSubmit:x},null,8,["type"]),v.value>0&&m.value?(n(),o("div",He,[e("p",Ne,[e("span",null,c(v.value)+" \u8BC4\u8BBA ",1),y(F,{"ml-15":"","cursor-pointer":"","text-18":"",class:P(g.value?"animate-spin":""),onClick:x},null,8,["class"])]),(n(!0),o(M,null,N(a.value,(u,A)=>(n(),o("div",{key:u.id,"my-5":"",flex:""},[e("div",null,[y(G,{src:d(H)(u.avatar),width:"40","duration-600":"","hover-rotate-360":""},null,8,["src"])]),e("div",Ue,[e("p",null,[u.website?(n(),o("a",{key:1,href:u.website,target:"_blank",color:"#1abc9c","font-500":"","transition-300":""},c(u.nickname),9,je)):(n(),o("span",Ze,c(u.nickname),1)),u.user_id===10?(n(),o("span",Ge," \u535A\u4E3B ")):w("",!0)]),e("div",Je,[e("div",Qe,[e("span",null,c(v.value-A)+"\u697C ",1),e("span",Ke,c(d(J)(u.created_at)),1),e("button",{"i-mdi:thumb-up":"",class:P(d(Z)(u.id)?"bg-red":""),"hover-bg-red":"",onClick:s=>L(u)},null,10,Oe),E(e("span",null,c(u.like_count),513),[[T,u.like_count]])]),e("button",{color:"#ef2f11",onClick:s=>k(A,u)}," \u56DE\u590D ",8,We)]),e("div",{"my-3":"",innerHTML:u.content},null,8,Xe),(n(!0),o(M,null,N(u.reply_vo_list,s=>(n(),o("div",{key:s.id,"mt-10":"",flex:""},[e("div",null,[y(G,{src:d(H)(s.avatar),width:"40","duration-600":"","hover-rotate-360":""},null,8,["src"])]),e("div",Ye,[e("div",null,[s.website?(n(),o("a",{key:1,href:s.website,target:"_blank",color:"#1abc9c","font-500":"","transition-300":""},c(s.nickname),9,tt)):(n(),o("span",et,c(s.nickname),1)),s.user_id===10?(n(),o("span",nt," \u535A\u4E3B ")):w("",!0)]),e("div",ot,[e("div",at,[e("span",st,c(d(J)(s.created_at)),1),e("button",{"i-mdi:thumb-up":"",class:P(d(Z)(s.id)?"bg-red":""),"hover-bg-red":"",onClick:te=>L(s)},null,10,ut),E(e("span",null,c(s.like_count),513),[[T,s.like_count]])]),e("button",{color:"#ef2f11",onClick:te=>k(A,s)}," \u56DE\u590D ",8,lt)]),e("div",null,[s.reply_user_id!==u.user_id?(n(),o(M,{key:0},[s.reply_website?(n(),o("a",{key:1,href:s.reply_website,target:"_blank"}," @"+c(s.reply_nickname),9,ct)):(n(),o("span",it," @"+c(s.reply_nickname),1)),I(" \uFF0C ")],64)):w("",!0),e("span",{"my-3":"",innerHTML:s.content},null,8,rt)])])]))),128)),E(e("div",{ref_for:!0,ref_key:"checkRefs",ref:p,"mt-15":"",color:"#6d757a","text-13":""},[I(" \u5171 "),e("b",null,c(u.reply_count),1),I(" \u6761\u56DE\u590D "),e("button",{color:"#00a1d6",onClick:s=>R(A,u)}," \uFF0C\u70B9\u51FB\u67E5\u770B ",8,_t)],512),[[T,u.reply_count>3]]),y(Ve,{ref_for:!0,ref_key:"pageRefs",ref:$,"page-total":Math.ceil(u.reply_count/5),index:A,"comment-id":u.id,onChangeCurrent:V},null,8,["page-total","index","comment-id"]),y(Q,{ref_for:!0,ref_key:"replyFieldRefs",ref:q,show:!1,type:l.type,"topic-id":h,onAfterSubmit:s=>C(A)},null,8,["type","onAfterSubmit"]),A+1!==v.value?(n(),o("div",dt)):w("",!0)])]))),128)),e("div",mt,[v.value>a.value.length&&!g.value?(n(),le(Y,{key:0,text:"",onClick:D},{default:ie(()=>[I(" \u70B9\u51FB\u52A0\u8F7D\u66F4\u591A... ")]),_:1})):w("",!0),g.value?(n(),o("div",pt,[y(ee,{size:"small"})])):w("",!0)])])):(n(),o("div",ft," \u6682\u65E0\u8BC4\u8BBA\uFF0C\u6765\u53D1\u8BC4\u8BBA\u5427~ "))])}}});export{yt as _};
